<!doctype html>
<html lang="en">
    <head>
        <title>BADE || <%= van.name %></title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <link rel="icon" type="image/x-icon" href="https://allchannels.com.ng/BADES.jpg">
        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="/sale.css" />
        <style>
          @media screen and (max-width: 480px) {
          .WHNav {
          display: none !important;
          }
          }
          .position-relative:hover{
          background-color: rgba(169, 169, 169, 0.568);
          color:rgb(216, 175, 42)
          }
          .position-relative{
          color:black
          }

          tbody tr{
            animation: fadeIn 2s forwards;
          }

          tbody tr:hover{
          background-color :#ffcc66c9;
          border:2px solid red;
          font-size: 0.8rem !important;
          font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
          cursor: grabbing;
          transition-delay:1s;
          animation:alternate 3s linear infinite ;
          }
  </style>
    </head>

    <body>
        <header>
            <!-- place navbar here -->
             <nav class="dash navbar navbar-light bg-light fixed-top">
                <div class="container-fluid">
                  <a class="navbar-brand"  href="/api/v1/POS/dashboard?page=1&limit=10&category=all&user=<%= user._id %>" title="Back">
                    <img 
                    width="30"
                    hegith="30"
                    src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
                    <b>Dashboard</b>
                  </a>
                      <button
                        class="navbar-toggler"
                        type="button"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar"
                        aria-controls="offcanvasNavbar"
                    >
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div
                        class="offcanvas offcanvas-end"
                        tabindex="-1"
                        id="offcanvasNavbar"
                        aria-labelledby="offcanvasNavbarLabel"
                    >
                        <div class="dash offcanvas-header">
                            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">
                                Menu
                            </h5>
                            <button
                                type="button"
                                class="btn-close text-reset"
                                data-bs-dismiss="offcanvas"
                                aria-label="Close"
                            ></button>
                        </div>
                        <div class="offcanvas-body">
                            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                              <div class="list-group " >
                              <%-include('../partials/USER.ejs')%>
                              <%if(user._id.toString() === van.Driver.toString()){%>
                                <li class="nav-item">
                                    <a
                                    class="list-group-item list-group-item-action"
                                        aria-current="page"
                                        href="/api/v1/Mycustomers?Mycustomers=<%= van._id%>"
                                        >
                                        <img width="30" height="30" src="https://img.icons8.com/color/48/shop.png" alt="shop"/>
                                        My Customers</a
                                    >
                                </li>
                                <li class="nav-item">
                                  <a
                                      class="list-group-item list-group-item-action"
                                      aria-current="page"
                                      href="/api/v1/New/Invoice?van=<%= van._id%>"
                                      >
                                      <img width="30" height="30" src="https://img.icons8.com/plasticine/100/invoice-1.png" alt="invoice-1"/>
                                      New Invoice</a>
                              </li>
                                <% } %>
                                <li class="nav-item">
                                    <a class="list-group-item list-group-item-action " href="/api/v1/Myproducts?Myproducts=<%= van._id%>">
                                      <img width="30" height="30" src="https://img.icons8.com/pastel-glyph/64/move-by-trolley.png" alt="move-by-trolley"/>
                                      Inventory</a>
                                </li>
                                <li class="nav-item">
                                  <a class="list-group-item list-group-item-action active" href="/api/v1/POS/Van?van=<%= van._id%>">
                                    <img width="25" height="25" src="https://img.icons8.com/stickers/100/dashboard-layout.png" alt="dashboard-layout"/>
                                    Dashboard</a>
                              </li>
                                <li class="nav-item dropdown">
                                    <a
                                        class="nav-link dropdown-toggle"
                                        href="#"
                                        id="dropdownId"
                                        data-bs-toggle="dropdown"
                                        aria-haspopup="true"
                                        aria-expanded="false"
                                        >More</a
                                    >
                                    <div
                                        class="dropdown-menu"
                                        aria-labelledby="dropdownId"
                                    >
                                        <a class="dropdown-item" href="/api/v1/Todays/Visit?van=<%= van._id%>"
                                            >
                                            <img width="30" height="30" src="https://img.icons8.com/fluency/48/route.png" alt="route"/>
                                            Todays Route</a
                                        >
                                        <a class="dropdown-item" href="/api/v1/PaymentMethods?van=<%= van._id %>"
                                            >
                                            <img width="30" height="30" src="https://img.icons8.com/color/48/split-transaction.png" alt="split-transaction"/>
                                            Register Payment</a
                                        >
                                        <% if ( van.Manager.toString() === user._id.toString() || user.isAdmin) { %>

                                          <a class="dropdown-item" href="/api/v1/van/Settings?van=<%= van._id%>"
                                              >
                                              <img width="30" height="30" src="https://img.icons8.com/cotton/64/settings--v1.png" alt="settings--v1"/>
                                              Settings</a
                                          >
                                          <% } %>
                                    </div>
                                </li>
                                </div>
                            </ul>
                            <form class="d-flex">
                                <input
                                    class="form-control me-2"
                                    type="search"
                                    placeholder="Search"
                                    aria-label="Search"
                                />
                                <button class="btn btn-outline-success" type="submit">
                                    Search
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
             </nav>
             
        </header>
        <main class="pt-4 ">
          <!-- display contents here -->
          <div class="overflow-auto m-2 mt-5 p-4 ">
            <div class="row gap-2 d-flex justify-content-evenly align-content-center">

              <div class="col-sm-3">

                <div class="card bg-dark text-light shadow rounded dash" style="background-image: url(https://img.icons8.com/color/48/banknotes.png);background-repeat: no-repeat;background-position: right;">
                  <div class="card-body">
                    <p class="card-title">Todays Sales</p>
                    <b class="card-text">₦<%= TodaySale %></b>
                  </div>
                </div>
              </div>

              <div class="col-sm-3">
                <div class="card shadow rounded text-dark dash"  style="background-image: url(https://img.icons8.com/color/48/google-maps-new.png);background-repeat: no-repeat;background-position: right; background-color: #ee7b7b;">
                  <div class="card-body">
                    <p class="card-title"><%= todayRouteCustomers.length %> Route Navigation</p>
                    <!-- <p class="card-text">With supporting text below as a.</p> -->
                    <a href="/api/v1/Todays/Visit?van=<%= van._id%>" class="btn-sm btn-primary text-light"><b>View Routes for today</b></a>
                  </div>
                </div>
              </div>

              <div class="col-sm-3">
                <div class="card shadow rounded  text-dark dash"  style="background-image: url(https://img.icons8.com/color/48/shop-local.png);background-repeat: no-repeat;background-position: right; background-color: #cdfaee;">
                  <div class="card-body">
                    <p class="card-title">Customer Sold to Today</p>
                    <!-- <p class="card-text">With supporting text below as a.</p> -->
                    <b class="text-dark"><%= customerSoldTo.length %> Customer(s) </b>
                  </div>
                </div>
              </div>

              <div class="col-sm-3">
                <div class="card shadow rounded  text-dark dash"  style="background-image: url(https://img.icons8.com/bubbles/50/sales-performance.png);background-repeat: no-repeat;background-position: right; background-color: #ee9949;">
                  <div class="card-body">
                    <p class="card-title">M.T.D Sales
                    </p>
                    <!-- <p class="card-text">With supporting text below as a.</p> -->
                    <b class="text-light">₦<%= salesforthemonnth %></b>
                  </div>
                </div>
              </div>

             

              <div class="col-sm-3">
                <div class="card shadow rounded bg-dark text-light dash"  style="background-image: url(https://img.icons8.com/color/48/get-cash.png);background-repeat: no-repeat;background-position: right;">
                  <div class="card-body">
                    <p class="card-title">M.T.D Payment collected</p>
                    
                    <b class=" ">₦<%= todaysPyment %></b>
                  </div>
                </div>
              </div>

              <div class="col-sm-3 ">
                <div class="card bg-dark text-light shadow rounded dash"  style="background-image: url(https://img.icons8.com/papercut/60/define-location.png);background-repeat: no-repeat;background-position: right;">
                  <div class="card-body">
                    <p class="card-title">T.G.T Achievied [₦<%= saleTarget %>]</p>
                    <!-- <p class="card-text">NGN0.00</p> -->
                    <div class="progress">
                      <div
                        class="progress-bar bg-success"
                        role="progressbar"
                        style="width:<%= !saleTargetPercentage ? 0 : Math.ceil(parseInt(saleTargetPercentage)) %>%"
                        aria-valuenow="0"
                        aria-valuemin="0"
                        aria-valuemax="100"
                        id="progress"
                      >
                      <%=saleTargetPercentage%>%
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
          <!-- display invoice here in a responsive table -->
            <div class="container-fluid overflow-y-scroll" style="height: 60dvh;">
                <div class="row">
                    <div class="col-12">
                      <br>
                      <div class="h-59 p-1 d-flex table-responsive custom-table-responsive animate__animated animate__backInLeft"  >
                        <%if(invoice.length > 0){%>
                          <table class="border w-100">
                            <thead class="border">
                              <td class="border"><b>REF NO</b></td>
                              <td class="border"><b>CUSTOMER</b></td>
                              <td class="border"><b>INVOICE DATE</b></td>
                              <td class="border"><b>STATUS</b></td>
                              <td class="border"> <b>ON-SITE PAY</b></td>
                              <td class="'border"><b>VALUE</b></td>
                            </thead>
                            <tbody id="tbody" class="mb-5">
                              <%invoice.sort((a,b)=>{return b.createdAt - a.createdAt}).forEach((Delivery)=>{%>
                             
                              <tr class="border" title="<%=Delivery.InvoiceStatus.substring(0,3).toUpperCase()%>/<%=Delivery.InvoiceNumber%>/<%=van.InvoiceReference%>">
                                <td class=""><a 
                                  <%if(Delivery.InvoiceStatus === 'cancelled'){%>
                                    class="text-danger"
                                   <%}else if (Delivery.InvoiceStatus === 'invoice'){%>
                                    class="text-success"
                                    <% } %>"
                                  href="/api/v1/RetailInvoice?order=<%=Delivery._id%>"><b><%=Delivery.InvoiceStatus.substring(0,3).toUpperCase()%>/<%=Delivery.InvoiceNumber%></b>
                                </a></td>
                                <td class=""><%=Delivery.customerName.toUpperCase()%></td>
                                <td class=""><%=Delivery.InvoiceDate.toString().substring(0,15)%></td>
                                <td class="p-1 text-center">
                                  <span <%if(Delivery.InvoiceStatus === 'cancelled'){%>
                                    class="text-danger" 
                                   <%}else if (Delivery.InvoiceStatus === 'invoice'){%>
                                    class="text-success"
                                    <% }else{%>
                                       class="text-primary"
                                   <% } %>>
                                    <%=Delivery.InvoiceStatus.toUpperCase()%>
                                  </span>
                                </td>
                                <td class="border">₦<%= Delivery.payment.map(Amount =>{
                                   return +Amount.Amount;  
                                }) %></td>
                                <td class="border">₦<%=Delivery.TotalPrice%></td>
                              </tr>
                              <%})%>
                            </tbody>
                        </table>
                        <%}else{%>
                          <p class="form-text text-muted">No Orders to show</p>
                          
                          <%}%>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end of invoice table -->

        </main>
        <footer style="z-index: 3 !important;">
            <!-- place footer here -->
            <div class="container-fluid fixed-bottom bg-dark-subtle ">
                <div class="row p-2">
                    <!-- for next and filter -->
                      <div>
                      </div>
                            <div class="row">
                              <div class="col-12">
                                  <p class="text-center">
                                      BADE &copy; <script>
                                          document.write(new Date().getFullYear());
                                      </script>. All rights reserved.
                                  </p>
                              </div>
                          </div>
                       </div>
                </div>
            </div>
            <!-- end of footer -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
