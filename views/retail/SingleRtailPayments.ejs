<!doctype html>
<html lang="en">
    <head>
        <title>BADE || <%= payment.paymentReferenceNo %></title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <link rel="icon" type="image/x-icon" href="https://allchannels.com.ng/BADES.jpg">
        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="/sale.css" />
        <style>
          @media screen and (max-width: 480px) {
          .WHNav {
          display: none !important;
          }
          }
          .position-relative:hover{
          background-color: rgba(169, 169, 169, 0.568);
          color:rgb(216, 175, 42)
          }
          .position-relative{
          color:black
          }

          tbody tr{
            animation: fadeIn 2s forwards;
          }

          tbody tr:hover{
          background-color :#ffcc66c9;
          border:2px solid red;
          font-size: 0.8rem !important;
          font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
          cursor: grabbing;
          transition-delay:1s;
          animation:alternate 3s linear infinite ;
          }
  </style>
        
    </head>

    <body>
        <header>
            <!-- place navbar here -->
             <nav class="dash navbar navbar-light bg-light fixed-top">
                <div class="container-fluid">
                  <span class="navbar-brand" onclick="history.back()" href="/" title="Back">
                    <img 
                    width="30"
                    hegith="30"
                    src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
                    <b><%= payment.paymentReferenceNo %></b>
                   </span>
                      <button
                        class="navbar-toggler"
                        type="button"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar"
                        aria-controls="offcanvasNavbar"
                    >
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div
                        class="offcanvas offcanvas-end"
                        tabindex="-1"
                        id="offcanvasNavbar"
                        aria-labelledby="offcanvasNavbarLabel"
                    >
                        <div class="dash offcanvas-header">
                            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">
                                Menu
                            </h5>
                            <button
                                type="button"
                                class="btn-close text-reset"
                                data-bs-dismiss="offcanvas"
                                aria-label="Close"
                            ></button>
                        </div>
                        <div class="offcanvas-body">
                            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                              <div class="list-group " >
                              <%-include('../partials/USER.ejs')%>
                             
                                </div>
                            </ul>
                           
                        </div>
                    </div>
                </div>
             </nav>
             
        </header>
        <main class="pt-4 mb-4 p-2 mt-5">
          <!-- display contents here -->
          <form id="Approve" data-reverseid="<%= payment._id %>" class="container mb-5 mt-5 p-3 flex items-center bg-light flex-col justify-center gap-3 shadow">
            <!-- Modal content -->
            <div class="content ">
                <div  class="row g-3 needs-validation" id="form">
                  <div class="col-md-4">
                      <label for="customer" class="form-label">CUSTOMER</label>
                      <h2 class="form-control"><%=customer.name.toUpperCase()%></h2>
                    </div>
                    
                      <div class="col-md-4">
                        <label for="customer" class="form-label">STATUS</label>
                        <h2 class="form-control"><%=payment.status.toUpperCase()%></h2>
                      </div>
                      
                      <div class="col-md-4">
                        <label for="remark" class="form-label"> POSTED BY </label>
                        <h5 class="form-control"><%=acccountant.firstName.toUpperCase()%> <%=acccountant.lastName.toUpperCase()%></h5>
                        </div>
        
                    <div class="col-md-4">
                        <label for="date" class="form-label">PAYMENT DATE</label>
                        <h5 class="form-control"><%=payment.PaymentDate%></h5>
                    </div>
        
                    <div class="col-md-4">
                        <label for="date" class="form-label">AMOUNT</label>
                        <h5 class="form-control">
                            <%=payment.transactionAmount%>
                        </h5>
                    </div>

                  <div class="col-md-4">
                      <label for="date" class="form-label">TYPE</label>
                      <h5 class="form-control">
                          <%=payment.collectionRef%>
                      </h5>
                  </div>

                  <div class="col-md-4">
                      <label for="date" class="form-label">REF NO</label>
                      <h5 class="form-control">
                          <%=payment.paymentReferenceNo%>
                      </h5>
                  </div>
        
                   <%if(payment.BillId === ''  && payment.status ==='posted' && payment.collectionRef ==='PTMT' && user.isCFO || user._id.toString() === payment.Accountant.toString() ){%>
                      <div class="col-md-4  ">
                        <label for="InvoiceNo" class="form-label">This action would also Reverese payment on corresponding <%= customer.name.toUpperCase() %> Ledger Report</label>
                          <button class="btn btn-warning form-control" id="" > Reverse <%= payment.paymentReferenceNo %></button>
                      </div>
                    <%}else{%>
                        <small class="text-muted">To cancel <a href="/api/v1/RetailInvoice?order=<%= payment.BillId %>"><%= payment.paymentReferenceNo %></a> , You will have to cancel the Invoice it was posted on</small>
                        
                    <% } %>
        
                    </div>
            </div>
        </form>
        </main>
        <footer style="z-index: 3 !important;">
            <!-- place footer here -->
            <div class="container-fluid fixed-bottom bg-dark-subtle ">
                <div class="row p-2">
                    <!-- for next and filter -->
                      <div>
                      </div>
                            <div class="row">
                              <div class="col-12">
                                  <p class="text-center">
                                      BADE &copy; <script>
                                          document.write(new Date().getFullYear());
                                      </script>. All rights reserved.
                                  </p>
                              </div>
                          </div>
                       </div>
                </div>
            </div>
            <!-- end of footer -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
        <script>
        // Your JavaScript code here
        document.getElementById('Approve').addEventListener('submit',async function(event) {
            event.preventDefault();
            const reverseId = this.dataset.reverseid;
            console.log(reverseId);
            await fetch(`/api/v1/reverse/retailPayment?id=${reverseId}&CustomerId=<%=payment.customer%>&user=<%=user._id%>`, {
                method: 'PATCH',
            })
           .then(response => response.json())
           .then(data => {
                console.log(data);
                location.reload();
            })
           .catch(error => {
                console.error('Error:', error);
            });
        });
        </script>
    </body>
</html>
