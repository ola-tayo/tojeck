
<!doctype html>
<html lang="en">
    <head>
        <title>BADE|| <%=  result.Departments.Name %> Team Ticket</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <link rel="icon" type="image/x-icon" href="https://allchannels.com.ng/BADES.jpg">
        <link rel="stylesheet" href="/sale.css" />
        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <style>
          .itemQty:focus{
            outline: none;
          }
    
          /* #item :nth-child(odd){
            background-color: #999a9c86;
            font-weight: bolder;
            font-size: '15px';
          } */
    
          @font-face {
            font-family: "Inter";
            src: url("Inter-Regular.ttf") format("truetype");
            font-weight: 400;
            font-style: normal;
          }
    
          @font-face {
            font-family: "Inter";
            src: url("Inter-Medium.ttf") format("truetype");
            font-weight: 500;
            font-style: normal;
          }
    
          @font-face {
            font-family: "Inter";
            src: url("Inter-Bold.ttf") format("truetype");
            font-weight: 700;
            font-style: normal;
          }
    
          @font-face {
            font-family: "Space Mono";
            src: url("SpaceMono-Regular.ttf") format("truetype");
            font-weight: 400;
            font-style: normal;
          }
    
          #invoice {
            font-size: 0.75rem;
            font-family: "Inter", sans-serif;
            font-weight: 400;
            color: #000000;
            margin: 0 auto;
            position: relative;
          }
    
          #pspdfkit-header {
            font-size: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 400;
            color: #717885;
            margin-top: 2.5rem;
            margin-bottom: 2.5rem;
            width: 100%;
          }
    
          .header-columns {
            display: flex;
            justify-content: space-between;
            padding-left: 2.5rem;
            padding-right: 2.5rem;
          }
    
          .logo {
            height: 3rem;
            width: auto;
            margin-right: 1rem;
          }
    
          .logotype {
            display: flex;
            align-items: center;
            font-weight: 700;
          }
    
          h2{
            font-family: "Space Mono", monospace;
            font-size: 1.25rem;
            font-weight: 400;
          }
    
          h4 {
            font-family: "Space Mono", monospace;
            font-size: 1rem;
            font-weight: 400;
          }
    
          .page {
            margin-left: 5rem;
            margin-right: 5rem;
          }
    
          .intro-table {
            display: flex;
            justify-content: space-between;
            margin: 3rem 0 3rem 0;
            border-top: 1px solid #000000;
            border-bottom: 1px solid #000000;
          }
    
          .intro-form {
            display: flex;
            flex-direction: column;
            border-right: 1px solid #000000;
            width: 50%;
          }
    
          .intro-form:last-child {
            border-right: none;
          }
    
          .intro-table-title {
            font-size:1rem;
            margin: 0;
          }
    
          .intro-form-item {
            padding: 1.25rem 1.5rem 1.25rem 1.5rem;
          }
    
          .intro-form-item:first-child {
            padding-left: 0;
          }
    
          .intro-form-item:last-child {
            padding-right: 0;
          }
    
          .intro-form-item-border {
            padding: 1.25rem 0 0.75rem 1.5rem;
            border-bottom: 1px solid #000000;
          }
    
          .intro-form-item-border:last-child {
            border-bottom: none;
          }
    
          .form {
            display: flex;
            flex-direction: column;
            margin-top: 6rem;
          }
    
          .no-border {
            border: none;
          }
    
          .border {
            border: 1px solid #000000;
          }
    
          .border-bottom {
            border: 1px solid #000000;
            border-top: none;
            border-left: none;
            border-right: none;
          }
    
          .signer {
            display: flex;
            justify-content: space-between;
            gap: 2.5rem;
            margin: 2rem 0 2rem 0;
          }
    
          input {
            font-family: "Space Mono", monospace;
            text-align: center;
            margin-top: none;
            box-sizing: border-box;
            text-align: left;
            border:none !important;
          }
    
          input#signature {
            height: 8rem;
          }
    
          .intro-text {
            width: 60%;
          }
    
          .table-box table,
          .summary-box table {
            width: 100%;
            font-size: 0.625rem;
          }
    
          .table-box table {
            padding-top: 2rem;
          }
    
          .table-box td:first-child,
          .summary-box td:first-child {
            width: 50%;
          }
    
          .table-box td:last-child,
          .summary-box td:last-child {
            text-align: right;
          }
    
          .table-box table tr.heading td {
            border-top: 1px solid #000000;
            border-bottom: 1px solid #000000;
            height: 1.5rem;
          }
    
          .table-box table tr.item td,
          .summary-box table tr.item td {
            border-bottom: 1px solid #d7dce4;
            height: 1.5rem;
          }
    
          .summary-box table tr.no-border-item td {
            border-bottom: none;
            height: 1.5rem;
          }
    
          .summary-box table tr.total td {
            border-top: 1px solid #000000;
            border-bottom: 1px solid #000000;
            height: 1.5rem;
          }
    
          .summary-box table tr.item td:first-child,
          .summary-box table tr.total td:first-child {
            border: none;
            height: 1.5rem;
          }
    
          #pspdfkit-footer {
            font-size: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
            color: #717885;
            margin-top: 2.5rem;
            bottom: 2.5rem;
            position: absolute;
            width: 100%;
          }
    
          .footer-columns {
            display: flex;
            justify-content: space-between;
            padding-left: 2.5rem;
            padding-right: 2.5rem;
          }
    
          .signer-item img {
            margin:10px;
          }
    
        </style>
        <input type="text" id="DepartmentId" hidden readonly value="<%= result.Departments._id %>">
        <script>
                  
        const DepartmentId = document.getElementById('DepartmentId').value;
document.addEventListener('DOMContentLoaded', async function() {

  plsWait(true);
    var calendarEl = document.getElementById('calendar');

    const request = await fetch('/api/v1/Getfulldb',{
        method:'GET',
        headers:{'Content-Type': 'application/json'},
    })
        const response = await request.json()

        
       
        response ?  plsWait(false) : ''
      // get open tickets from the server
      const openTickets = response.Tickets.filter(ticket => {
        return ticket.status.includes('Open') && ticket.internalUnitId === DepartmentId
      })

      const closedTickets = response.Tickets.filter(ticket => {
        return ticket.status.includes("Closed") && ticket.internalUnitId === DepartmentId
      })

      // get data for pie chart on ware house invoice // PIE CHART
      const xArray = [ openTickets.length, closedTickets.length];
      const yArray = ["UNRESOLVED","RESOLVED"];

      const data = [{
        x: xArray,
        y: yArray,
        type: "bar",
        orientation: "h",
        marker: {color:"rgba(255,0,0,0.6)"}
      }];

      const layout = {title:"TICKET STATISTICS"}

      Plotly.newPlot("PIE", data, layout);

    })
    </script>
    </head>
  
    <body>
        <header>
            <%-include('./partials/Notification.ejs')%> 
            <%-include('./partials/inactive.ejs')%>
            <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
            <!-- place navbar here -->
            <nav class="dash navbar navbar-light bg-light fixed-top" 
            style="background-color: rgb(173, 168, 105) !important">
                <div class="container-fluid">
                    <span  class="navbar-brand" >
                        <img 
                        onclick="history.back()"
                        width="30"
                        hegith="30"
                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAA
                        ACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
                       <b> <%=  result.Departments.Name %> Team Ticket</b>
                    </span>
                    <button
                        class="navbar-toggler"
                        type="button"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar"
                        aria-controls="offcanvasNavbar"
                    >
                    <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <div
                        class="offcanvas offcanvas-end"
                        tabindex="-1"
                        id="offcanvasNavbar"
                        aria-labelledby="offcanvasNavbarLabel"
                    >
                        <div class="dash offcanvas-header bg-dark-subtle ">
                            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">
                                Menu
                            </h5>
                            <button
                                type="button"
                                class="btn-close text-reset"
                                data-bs-dismiss="offcanvas"
                                aria-label="Close"
                            ></button>
                        </div>
                        <div class="offcanvas-body ">
                            <!-- uls -->
                            <ul class="nav nav-tabs d-flex  align-content-center  " id="myTab" role="tablist" >
                              <%-include('./partials/USER.ejs')%>
                           
                                <!-- <li class="nav-item " role="presentation">
                                    <button
                                        class="nav-link "
                                        id="profile-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#profile"
                                        type="button"
                                        role="tab"
                                        aria-controls="profile"
                                        aria-selected="false"
                                        title=""
                                    >
                                    Add New Team
                                    </button>
                                </li> -->
                                <li class="nav-item active" role="presentation">
                                    <button
                                        class="nav-link active"
                                        id="messages-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#messages"
                                        type="button"
                                        role="tab"
                                        aria-controls="messages"
                                        aria-selected="false"
                                        title="Expense List"
                                    >
                                    Ticket List
                                    </button>
                                </li>
                               </ul> 
                               <!-- add serach here -->
                        <div class="list-group mb-5" >
                          
                        
                            <div class="list-group-item list-group-item-action justify-content-between d-flex"
                            >
                            <div id="PIE" style="width:100%; max-width:600px; height:450px;"></div>
                            </div>
                        </div>
                       <!-- endes here -->
                        </div>
                         
                    </div>
                </div>
            </nav>
            
           <!-- Nav tabs -->
          
        </header>

        <main class="pt-4 ">
            <!-- Tab panes -->
            <div class="tab-content mt-5 ">
           
                <div
                    class="tab-pane "
                    id="profile"
                    role="tabpanel"
                    aria-labelledby="profile-tab"
                >
                   <div class="container ">
                    <!-- additional view here -->
                   </div>
                </div>
                <div
                    class="tab-pane active"
                    id="messages"
                    role="tabpanel"
                    aria-labelledby="messages-tab"
                >
                   <div class="container-fluid mt-5 mb-5 ">
                       
                    <%if(result.Helpdesk.length > 0){%>
                      <%result.Helpdesk.sort((a,b)=>{return b.createdAt - a.createdAt}).forEach(expense=>{%>
                        <span onclick="location.assign('/api/v1/Ticket?id=<%=expense._id%>')" class="list-group position-relative mb-2">
                          <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" >
                              <small class="position-absolute top-0  start-50 translate-middle badge rounded-pill bg-warning">
                                <span class="badge bg-secondary"><%=expense.status%></span>
                              </small>
                              <h6>
                                  <a href="/api/v1/Ticket?id=<%=expense._id%>" class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" >
                                    <%=expense.TicketId%>/[<%=expense.date%>]/[Priority: <%= expense.Priority %>]
                                   </a> 
                             </h6>
                            </div> 
                            
                          </span>
                      <%})%>
                    <%}else{%>
                   <p>Nothig to display</p>
                    <%}%>
                   </div>
                    
                </div>
               </div>
        </main>
        <footer style="z-index: 3 !important;">
          <!-- place footer here -->
          <div class="container-fluid fixed-bottom bg-dark-subtle ">
              <div class="row p-2">
                  <!-- for next and filter -->
                  <div class="contaner d-flex justify-content-between">
                    <div>
                             <!-- next and prev btn -->
                             <button type="button" class="btn btn-dark shadow-sm me-2"
                             <%if(!result.Previous){%>
                               disabled
                               <%}%>
                               <%if(result.Previous){%>
                                 onclick="location.assign('/api/v1/CFO/EXPENSE/<%=user._id%>/?page=<%=result.Previous.page%>&limit=9')"
                                 <%}%>
                             >
                             Prev
                           </button>
                             
                             <button type="button" class="btn btn-dark shadow-sm me-2" <%if(!result.next){%>
                               disabled =true
                               <%}%>
                               <%if(result.next){%>
                                 onclick="location.assign('/api/v1/CFO/EXPENSE/<%=user._id%>/?page=<%=result.next.page%>&limit=9')"
                                 <%}%>
                               >
                               Next
                              </button>
                     <!--  -->
                    </div>
 
                    <div>
                     
                    </div>
                          <div class="row">
                            <div class="col-12">
                                <p class="text-center">
                                    BADE &copy; <script>
                                        document.write(new Date().getFullYear());
                                    </script>. All rights reserved.
                                </p>
                            </div>
                        </div>
                     </div>
              </div>
          </div>
          <!-- end of footer -->
          <input type="hidden" id="Signature" value="<%=user.Signature%>">
      </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
         <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>

    </body>
</html>
