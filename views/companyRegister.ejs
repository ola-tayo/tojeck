<!DOCTYPE html>
<html lang="en">
  <%-include('./partials/head.ejs')%>
  <body>
    <nav class="navbar bg-black">
      <div class="container-fluid">
        <span class="navbar-brand" onclick="history.back()" href="/" title="Back">
          <img 
          width="30"
          hegith="30"
          src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
         </span>
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item dropdown">

                  <h5>
                    <a
                    class="nav-link breadcrumb-item active"
                    aria-current="page"
                    href="/"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    style="color: #fff !important"
                  >
                  Company Details
                  </a>
                  </h5>
                
                </li>
          </ul>
          <%-include('./partials/USER.ejs')%>
          <%-include('./partials/inactive.ejs')%>
      </div>
    </nav>

    
    <form id="companyform" class=" shadow-lg m-4 p-3 row g-3 needs-validation">
      <h5 class="form-text">BADE Business Account Setup</h5>
      <div>
        <div class=" ">
            <div id="productImage" style="background-image: url( https://cdn.pixabay.com/photo/2019/08/11/18/59/icon-4399701_640.png);"></div>
            <!-- display progress % for photo upload -->
            <!-- <progress value="0" max="100" id="progress"></progress> -->
            <!-- <input type="url" name="image" disabled id="imageLoader" class='hidden'> -->
          </div>
    </div>
        <div class="col-md-6">
            <label for="inputEmail4" class="form-label">Business Email</label>
            <input type="email" class="form-control"  required id="inputEmail4" name="email">
          </div>
          <div class="col-md-6">
            <label for="inputPassword4" class="form-label">Business Name</label>
            <input type="text" class="form-control" required id="inputPassword4" name="CompayName">
          </div>
          <div class="col-md-6">
            <label for="inputPassword4" class="form-label">Anniversiry Date</label>
            <input type="date" class="form-control" id="inputPassword4" required name="Anniversiry">
          </div>
          <div class="col-6">
            <label for="inputAddress" class="form-label">Business Address</label>
            <input type="text" class="form-control" id="inputAddress" required placeholder="1234 Main St" name="Address">
          </div>
          <div class="col-6">
            <label for="ShopAddress" class="form-label">Shop Address</label>
            <input type="text" class="form-control" id="ShopAddress" required placeholder="1234 Main St" name="ShopAddress">
          </div>
          <div class="col-6">
            <label for="inputAddress2" class="form-label">Business Tel..</label>
            <input type="tel" class="form-control" id="inputAddress2" required placeholder="Tel..." name="Tel">
          </div>
          <div class="col-md-6">
            <label for="inputCity" class="form-label">Business City</label>
            <input type="text" class="form-control" id="inputCity" required name="CompanyCity">
          </div>
          <div class="col-md-5">
            <label for="inputState" class="form-label">Business State</label>
            <select id="inputState" class="form-select" required name="CompayState">
              <option selected>Choose...</option>
              <%if(states){%>
                <%states.forEach(state=>{%>
                  <option value="<%=state.state%>"><%=state.state%></option>
                <%})%>
              <%}%>
              <option>...</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="inputZip" class="form-label"> Business Zip</label>
            <input type="text" class="form-control" required id="inputZip" name="CompayZip">
          </div>
          <div class="col-md-3">
              <label for="inputLogo" class="form-label"> Business Logo</label>
              <input type="file" class="form-control" id="files" required name="CompanyLogo">
              <input type="hidden" name="imageLoader" id="imageLoader">
              <input type="hidden" name="user" value="<%=user._id%>"> 
            </div>
            <div class="col-md-6">
              <label for="InvoicePolicy" class="form-label">Invoicing policy</label>
              <textarea type="text" class="form-control" id="InvoicePolicy" required name="InvoicePolicy"></textarea>
            </div>
         
          <div class="col-12">
            <button type="submit" class="btn btn-dark">Submit</button>
          </div>
          <%-include('./partials/footer.ejs')%>
            </form>

  </body>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase.js"></script>
  <script src="/ImageUpload.js" type="module"></script>
  <script>
    try{//eventlistener for companyform
    const companyform = document.getElementById("companyform")
    companyform.addEventListener("submit",async(e)=>{
        e.preventDefault()
        //form input listener
        const AdminId = companyform.user.value
        const endpoint = `/api/v1/company/register/${AdminId}`
        const request = await fetch(endpoint,{
          method:'POST',
            body:JSON.stringify({
                email:companyform.email.value,
                CompayName:companyform.CompayName.value,
                Address:companyform.Address.value,
                Tel:companyform.Tel.value,
                CompanyCity:companyform.CompanyCity.value,
                CompayState:companyform.CompayState.value,
                CompayZip:companyform.CompayZip.value,
                CompayLogo:companyform.imageLoader.value,
                AnniversiryDate:companyform.Anniversiry.value,
                InvoicePolicy:companyform.InvoicePolicy.value,
                ShopAddress:companyform.ShopAddress.value
            }),
            headers: {"content-type": "application/json"}

        })
        const response = await request.json()
        alert(response.message||response.error)
        if(response.message){
            companyform.reset()
            location.assign('/api/v1/dashboard')
        }else{
            throw new Error(response.error)
        }
        
    })

    }catch(error){
        alert(error)
    }


    </script>
</html>