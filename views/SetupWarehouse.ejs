
<!doctype html>
<html lang="en">
    <head>
        <title><%=name%> || <%=warehouse.WHName.toUpperCase()%> INVENTORY ADJUSTMENT</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <link rel="icon" type="image/x-icon" href="https://allchannels.com.ng/BADES.jpg">

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="/sale.css" />
    </head>
  
    <body onload="getProduct()">
        <header>
            <%-include('./partials/Notification.ejs')%> 
            <%-include('./partials/inactive.ejs')%>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
            <!-- place navbar here -->
            <nav class=" dash navbar navbar-light bg-light fixed-top border-bottom" 
            style="background-color: rgb(173, 168, 105) !important">
                <div class="container-fluid">
                    <span  class="navbar-brand" >
                      <a class="navbar-brand" onclick="history.back()" title="Back">
                        <img 
                        width="30"
                        hegith="30"
                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmp
                        wYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8z
                        H3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
                      </a>
                       <b>INVENTORY ADJUSTMENT / <%=warehouse.WHName.toUpperCase()%></b>
                    </span>
                    <!-- <a  >Setup Location</a> -->
                    <button
                        class="navbar-toggler"
                        type="button"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar"
                        aria-controls="offcanvasNavbar"
                    >
                    <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <div
                        class="offcanvas offcanvas-end"
                        tabindex="1"
                        id="offcanvasNavbar"
                        aria-labelledby="offcanvasNavbarLabel"
                        
                    >
                        <div class="dash offcanvas-header bg-dark-subtle "  style="background-color: rgb(173, 168, 105) !important">
                            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">
                                Menu
                            </h5>
                            <button
                                type="button"
                                class="btn-close text-reset"
                                data-bs-dismiss="offcanvas"
                                aria-label="Close"
                            ></button>
                        </div>
                        <div class="offcanvas-body ">
                            <!-- uls -->
                            <ul class="nav nav-tabs d-flex  align-content-center  " id="myTab" role="tablist" >
                              <%-include('./partials/USER.ejs')%>
                                  
                                <li class="nav-item " role="presentation">
                                  <button
                                      class="nav-link "
                                      id="profile-tab"
                                      data-bs-toggle="tab"
                                      data-bs-target="#profile"
                                      type="button"
                                      role="tab"
                                      aria-controls="profile"
                                      aria-selected="false"
                                      title="Export Inventory Table to Xlsx"
                                      onclick="location.assign('/api/v1/XLSX/Report/<%=warehouse._id%>')"
                                  >
                                  <img height="30" width="30" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB90lE
                                  QVR4nGNgGAWjYBSMgiEJxCYEZ4hNCP4oNjHkP6lY81A96fhg3Uetg3Xp1PQAWY4n2wOHwPgD9TxApuMp9MD/UQ/AwGgMHBpNQsM0CXEXWhRwF1p84Smy+E8RLrH8L9TsMSAe+EKx42G42OI/T4MrBpZck0o2ZiAEqOZ4GB71QOpoDPwXLrP9f+f1o/8gULVpEjx5aLUE/v/x+9f/b79+/NdpDR7cSShiXhnYA2++vP8vUekEFlt5didYrGHr9KGRB3ZdPw52cOO2Gf8te2L///339//tVw/BMTQkPGDSGfn/15/f/99/+/T/2L0L///9+/ffa1r20CqFphxc8R8Glp/ZPvSK0YUnNsE9sOLsDoIeEHfXwsBC04LIxgyUeMBzahY42Zx6cPn/kbvnwZ7wn5k/NDwgXGb7/8aL+2BHg9K9/YQksGcevn32X6zCcfB7oHvPArDjd1w7ChfbdOkAWKx378LB7QGzrihw6QMqNq174+Dihh1h/3///QPGVr2xg9cDPBTgUQ9MG2kxwF1k/plqHigwHwAPFJrnUcUTBeb/hKL0v4m7a75Hx6oZDmRjBmoBCQ+t/+Ri9TR7s
                                  jHDqAegYDQG0kaT0EhPQu5aH+nvATvqTXBIemilSXhofaCfB+w+qKbYp1LNA6NgFIyCUcBADQAA6UC2Ipn+q/gAAAAASUVORK5CYII=">
                                  </button>
                              </li>
                                <li class="nav-item active shadow" role="presentation">
                                    <button
                                        class="nav-link active"
                                        id="profile-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#profile"
                                        type="button"
                                        role="tab"
                                        aria-controls="profile"
                                        aria-selected="false"
                                        title="List of Locations"
                                    >
                                     SET-UP <%= warehouse.WHName.toUpperCase()  %> 
                                    </button>
                                </li>
                                <!-- <li class="nav-item" role="presentation">
                                    <button
                                        class="nav-link "
                                        id="messages-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#messages"
                                        type="button"
                                        role="tab"
                                        aria-controls="messages"
                                        aria-selected="false"
                                        title="Add New Location"
                                    >
                                    </button>
                                </li> -->
                               </ul> 
                            <div class="d-flex"  >
                                <input
                                    id="search"
                                    class="form-control"
                                    type="search" 
                                    placeholder="Search Products..." 
                                    aria-label="Search" 
                                />
                                <button class="btn btn-success" type="submit">
                                    Search
                                </button>
                              </div>

                            
                            <form class="list-group mt-2 mb-5" id="EditWareHouseForm" novalidate>
                              EDIT <%=warehouse.WHName.toUpperCase()%>
                              <div class="list-group-item list-group-item-action"
                                >
                                <label for="validationCustom01" class="form-label">ALIAS</label>
                                <input type="text" class="form-control" id="validationCustom01" name="WHName" value="<%=warehouse.WHName.toUpperCase()%>" required>
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <label for="validationCustom02" class="form-label">TELEPHONE NUMBER</label>
                                <input type="text" class="form-control" id="validationCustom02" value="<%=warehouse.Tel%>" name="Tel" required>
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <label for="validationCustomUsername" class="form-label">EMAIL</label>
                                <div class="input-group has-validation">
                                  <span class="input-group-text" id="inputGroupPrepend">@</span>
                                  <input type="text" class="form-control" id="validationCustomUsername" name="Email" value="<%=warehouse.Email%>" aria-describedby="inputGroupPrepend" required>
                                </div>                  
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <label for="validationCustom03" class="form-label">ADDRESS</label>
                                <input type="text" class="form-control" id="validationCustom03" name="Address" value="<%=warehouse.Address%>" required>
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <label for="validationCustom04" class="form-label">STATE</label>
                                <input class="form-control" id="validationCustom04" name="state" value="<%=warehouse.state%>" required />
                                <input type="text" id="ADMINID" value="<%=user._id%>" hidden>
                                <input type="text" id="WHID" value="<%=warehouse._id%>" hidden>
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <label for="Manager" class="form-label">MANAGER</label>
                                <select type="text" class="form-select" id="Manager" name="Manager" required>
                                  <OPtion><%=warehouse.Manager.firstName%> <%=warehouse.Manager.lastName%> [Current]</OPtion>
                                  <%if(employe ){%>
                                      <%employe.forEach(employe=>{%>
                                        <option value="<%=employe._id%>"><%=employe.firstName%> <%=employe.lastName%></option>
                                        <% })%>
                                        <%}%>
                                </select> 
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <label for="StoreKeeper" class="form-label">STORE KEEPER</label>
                                <select type="text" class="form-select" id="StoreKeeper" name="StoreKeeper" required>
                                  <OPtion><%=warehouse.StoreKeeper.firstName%> <%=warehouse.StoreKeeper.lastName%> [Current]</OPtion>
                                  <%if(employe ){%>
                                  <%employe.forEach(employe=>{%>
                                    <option value="<%=employe._id%>"><%=employe.firstName%> <%=employe.lastName%></option>
                                    <% })%>
                                    <%}%>
                                </select> 
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <label for="location" class="form-label">Location</label>
                                <select type="text" class="form-select" id="location" name="location" required>
                                  <%if(warehouse.location){%>
                                    <% set = location.filter((loc) =>{%>
                                      <% return loc._id.toString() === warehouse.location.toString()%>
                                    <%})%>
                                    <%set.map(selected =>{%>
                                      <option value="<%=selected._id%>"> <%=selected.name%> [Current]</option>
                                    <%}) %>
                                    <%}else{%>
                                      <option value="">Choose...</option>
                                      <%}%> 
                  
                                  <%if(location ){%>
                                  <%location.forEach(location=>{%>
                                    <option value="<%=location._id%>"><%=location.name%></option>
                                    <% })%>
                                    <%}%>
                                </select> 
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <div class="form-check form-switch ">
             
                                  <label class="form-check-label" for="notifySalesOrder">
                                    <input class="form-check-input" type="checkbox"   name="Status" id="notifySalesOrder"<%if(warehouse.Status=== true){%>
                                      checked
                                  <%}%>>
                                    <%if(warehouse.Status){%>
                                      Deactivate <%=warehouse.WHName.toUpperCase()%>
                                      <%}else{%>
                                          Activate <%=warehouse.WHName.toUpperCase()%>
                                      <%}%>
                                  </label>
                                </div>
                               </div >
                               <div class="list-group-item list-group-item-action"
                                >
                                <button class="btn btn-primary" type="submit">SUBMIT</button>
                               </div >
                              
                            </form>   
                </div>
            </nav>
            
           <!-- Nav tabs -->
          
        </header>

        <main class="pt-4 ">
            <!-- Tab panes -->
            <div class="tab-content mt-5 ">
           
                <div
                    class="tab-pane active"
                    id="profile"
                    role="tabpanel"
                    aria-labelledby="profile-tab"
                >
                    <!-- display here -->

                    <div class="table-responsive custom-table-responsive container-fluid " >
    
                      <table class="table custom-table " style="font-size: 15px !important;">
                        <thead >
                          <tr >  
              
                              <th scope="col" class="border">SUMMARY</th>
                              <th scope="col" >PRODUCT</th>
                              <th scope="col" >REF</th>
                              <th scope="col" >PHOTO</th>
                              <th scope="col" >CRTN</th>
                              <th scope="col" >ROLL </th>
                              <th scope="col"  class="border">STATUS</th>
                          </tr>
                        </thead>
                        <tbody id="tbody">
                  <%if(result.storeProducts.length > 0 ){%>
                      <%result.storeProducts.sort((a,b)=>{return b.currentQty - a.currentQty}).forEach(product=>{%>
                          <!-- activity log -->
                            <td  id="incoming" class="border-end">
                                  <div class=" " scope="col">
                                      <!-- Split dropstart button -->
                                    <div class="btn-group dropstart" style="border-right: 1px dotted rgb(190, 190, 190) !important;" role="group">
                                    <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                                      <span class="visually-hidden">Toggle Dropstart</span>
                                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAADR0lEQVR4nJ2Vy08TURjF51/Qlf+CS/CFUp6FtrSdvqctbYc+gBYfVJDHQlQkIeIbwfCIC0KCMYrR6MZEKSpEHoIkujAECxsgUCQpAlNYuDjmXqBhBAbKJN9mJvf73Xu+c88wFr6Qs3n8EZvXD85dBK6gEGbeB5PLC4PTA4PDDZ2dB2vjlzUOxxEm0cfmDUQmwmGsr6/vWmtra7RuNzZDwzn8CQPyfYF4o1gstmf1fPwMNefoTRhg9/opQKp5LBZDNLpE5Pqr5rhjCQFsewCqrteh+kad6F39vYdQme1QmWxQGK3I0XOQ6yzIZk3I0pqQoTEgQ61HmkoHmYKdlSlYLWP1FIsAvxcX0dT6BPr8AjrcxpZ2+o586+3rp2BBECQrEongQ+8npCo0MyLAysoKKq/VovBmO4rbhsDd7YW+9A6C1TX029LSEswuL6ZnZiUB8/PzmJqawrlcDRhizS3Al8FhOMvrUNM9Dr5tDLamEZgaeqD1VaJ/YIguvvWgCd2v3x4IcDZHDYb4fgtwvryK+p7Iw9p5aG0uYk2oLQ54LwTp4r6BQQSrrx4OsFcJ2xYvLy/D6PJArjPT4WZqjHS46Xkbw7W6i+KAlJw8MJYEAYIg0Ev39MXLfU9wRp4HhsSCFEDYpcHA8AgCZZWSgMnJSZzOVokBgcsVO7RXbfreXXIp3oA4yuTybMij1lN5ZEoWqUotiCIiAAm1vU4gNcj7j1vQ0fVM+gRZSjBGp+dQgK+jY3CXlEoCTmUpwBi2AYqDV6C1Oqk8eZZ8Ko/SuBELBYGLoiarq6tUDhoLRB6Fll4sM+/dCdgtSfeLA0EQ8Ki1He0dnTvAW4CTmQTgcO8AHKS5IAgY+/4Ddl9A1Hw74ERGLhidnZ//OT5xKMAqkYn3UXnIrSUXy+T0iAEazmlkra653axJtM81SETypvbPX72J7377CZLTc5DQvyNdbTiut/MIhXoQCoVQW9+AQFkFotGoCDA3N7cJkCcGYAhEpR/t7OpCc2sbddGvcBgLCwvxIv8CEhPhcBhJaYcAyFRsqd3np7d95NsYbUZ2+3+9e9+DJFn2dMKAFIXiqEzJ/iGxQHxPhktCjcQC8T2xJtE+OV0+nSSTq/4BNITUZwFW2l8AAAAASUVORK5CYII="
                                      width="20"height="20" >
                                    </button>
                                    <ul class="dropdown-menu p-2" style="overflow-y: scroll;position: fixed;z-index: 1; height:150px;">
                                      <!-- Dropdown menu links -->
                                      <span>History Logs</span>
                                      <div>
                                          <% product.ActivitiyLog.map(log=>{%>
                                                  <p class="border"><%=log.message%></p>
                                          <%})%>
                                      </div>
                                    </ul>
                                <!--ends here  -->
                                  <td title="<%=product.productName%>">
                                      <%=product.productName%>
                                      <a class="text-primary" href="/api/v1/Product/<%=product.productId%>" title="About <%=product.productName%>">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
                                          <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"/>
                                          <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"/>
                                        </svg>
                                      </a>
                                  </td>
                                  <td>
                                      <%=product.ADCcode%>
                                  </td>
                                  <td>
                                             <!-- product scale -->
                                       <img width="50" height="50" style="filter: drop-shadow(1px 1px 5px rgb(19, 20, 19));" src='
                                       <%if(product.image ) {%>
                                          <%=product.image%>
                                      <%}else{%>
                                          data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD9UlEQVR4nO2dT08TQRiHl8QvoNGEbbbtxXD2b2IFCREUbxrxAMabeG27RDi0BvkAJEakKibtzcgFL8aDiRdSh6MpR++WwIHYmXBS4TVTaWxaSmfLru8Cv1/yXtvkefad2c40M5aFIAiCIAiCIAiCIPtFKXVNSrkopSxLKX8rpQiljBloZlLK71LKd0qpvo6fNiI6IaV8BfjK1wdQSpnTbD0LgQwV2EhQLpcLnocpdIYKdGguFArjlmV1mXbHIoSoQIWsrpa+RKPRS6ZCyo0fkHu+REP9Lg0kkqiEOQPNLDe31CRkY2Nj03Hsse7u7jMmQprepiAj2fGDeKN/oklIpVLZ1kJischVkzmk6QPQGckDMdiLqRbiOPadAwsh4aJEewZmQiKjECL+zwNl2CFjECIg5FgOcQPoEJddAoQIfvAQIvhhQ4jgBwwhgh8qhAh+kBASAngEIfzA6KgIqdVgX5Kyj1L0eT6Nmk9TdjxVZeJxcbG9ECnlT9Pl98HeJGTM/30gr/d6Wn7f8dIh35o2qOZab1ChQ9JVBq02qF6+eL/XBtUPL0LettuCxHK863nOaNzCNV5+39raOiel3IEQ19dJvL4mJycyxhtUu10yCyFuIEKKxeUPteHKaAtXh4i6lFLPpJTbGLJcX4ToibxYLH6Mx537/4TETlpeUqlULkOI64uQqanH2ZoIXfF45LwnGXXDFyZ14d8PQT2Rx2L2hY5kQIjr+y9zx3FOdSyDQ8ivZZdeZ1I0ctP/P+WNDKdoIZOufkdol0rCJmQhs/ePLD9LfweEGAoZCaAzGuvucApCjIUMpwIXcu+W/52NISvRuZA3WXSIp0l9IZMOpFMwqR+jGjiqb1l0SAtCBL8ECBH84CFE8MOGEMEPGEIEP1QICQFIghB+eAQh/MAIQvghEYTwgyEI4YdBISgsnQh+CRAi+MFDiOCHDSGCHzCECH6oEBICkAQh/PAIQviBEYTwQyII4QdDEMIPg0JQWDoR/BIgRPCDhxDBDxtCBD9gCBH8UCEkBCAJQvjhEYTwAyMI4YdEEMIPhiCEHwaFoLB0IvglQIjgBw8hgh/2oRKCSjYxCFQILglL+nYJmF9Cyl5OKT3ONdTiFNL19fVNP4Xoi3XbHuyIUi0ZlEpfzU8hNRBypd0ppSi1L4OZmemnWkg0at8+sJBdKTlAVx09eCsrK5/qzllM+CJEXzm9traWhxTlWUZPz9kHNSFGV616ST6ff1gqlYSepPSbAwSpprcpzUafXD09/aQ6TNUdCXvRCiBd+pbj+i9C2W0Z7Mowu667k+jW06cy60lKvzlAit0gITKq2WhGtm2fDkwEgiAIgiAIgliHLn8AKSCcApR8l94AAAAASUVORK5CYII=
                                      <%}%>' alt="photo here" >
                                  </td>
                                  <td style="font-weight: bold;color: <%if(product.currentQty > 5) {%>
                                      greenyellow
                                  <%}else{%>
                                  red
                                  <%}%>;">
                                     <input type="number"  <%if(product.isActivated){%>
                                      disabled
                                  <%}%> data-id="<%=product._id%>"  id="Cartorn" value=<%=product.currentQty%>>
                                  </td>
          
                                  <td style="font-weight: bold;color: <%if(product.currentQty > 0) {%>
                                      greenyellow
                                  <%}else{%>
                                  red
                                  <%}%>;">
                                      <!-- ware house qty -->
                                      <input type="number" 
                                      <%if(product.isActivated){%>
                                        disabled
                                    <%}%>
                                       id="Roll" data-id="<%=product._id%>"  value=<%=product.Rolls%> id="">
                                  </td>
                                  <td  class="border-start">
                                      <div class="form-check form-switch col-4 ">
                                        <input class="form-check-input" data-id="<%=product._id%>" type="checkbox" id="toggleReplenish"   Name="AutoReplenish" <%if(product.isActivated=== true){%>
                                          checked
                                      <%}%>/>
                                        <label class="form-check-label" for="toggleReplenish" title="Toogle to Activate or Deactivate this Product On Invoice Builder"></label>
                                      </div>
                                  </td>
                                 
                            </tr>
                           
                      <%})%>
                  <%}%>  
                        </tbody>
                      </table>
                    </div>
                   
                   </div>
                </div>
                
                <div
                    class="tab-pane"
                    id="messages"
                    role="tabpanel"
                    aria-labelledby="messages-tab"
                >
                   <div class="container mb-3 pb-5">
                       <!-- delivery -->

                      
                       
                   </div>
                    
                </div>
               </div>
        </main>
        <footer style="z-index: 3 !important;">
            <!-- place footer here -->
            <div class="container-fluid fixed-bottom bg-dark-subtle ">
                <div class="row p-2">
                    <!-- for next and filter -->
                    <div class="contaner d-flex align-content-center justify-content-between">
                      <div>
                        <!-- next and prev btn -->
                <button class="btn me-2 btn-dark"  <%if(!result.Previous){%>
                  disabled
                  <%}%>
                  <%if(result.Previous){%>
                    class="btn btn-dark shadow-sm me-2"
                    onclick="location.assign('/api/v1/SetUp/<%=warehouse._id%>/<%=user._id%>?page=<%=result.Previous.page%>&limit=15')"
                  <%}%>
                  >prev
                  </button>
                  <button 
                  class="btn me-2 btn-dark"
                  <%if(!result.next){%>
                    disabled
                    <%}%>
                    <%if(result.next){%>
                      class="btn btn-dark shadow-sm me-2"
                      onclick="location.assign('/api/v1/SetUp/<%=warehouse._id%>/<%=user._id%>?page=<%=result.next.page%>&limit=15')"
                  <%}%>
                  >Next</button>
                <!--  -->
               </div>
   
                      
                      
                            <div class="row">
                              <div class="col-12">
                                  <p class="text-center">
                                      BADE &copy; <script>
                                          document.write(new Date().getFullYear());
                                      </script>. All rights reserved.
                                  </p>
                              </div>
                          </div>
                </div>
            </div>
        
        </footer>
      
        <input type="hidden" id="WHIDS" value="<%=warehouse._id%>">
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>

           // SEARCH PRODUCTS
    const getProduct = async ()=>{
      plsWait(true)
        const WHID =  document.querySelector('#WHIDS').value;
        const endPoint = `/api/v1/api/product/bill/${WHID}`
        const res =await fetch(endPoint,{
          method:'GET',
          headers:{'Content-Type': 'application/json'}
        })
        const data = await res.json()
 // render product on list for search and update

  const ServerData = await data.sort(function(a, b){return b.currentQty - a.currentQty})
 
 const SearchBar = document.getElementById('search')
  SearchBar.addEventListener('change',async (e)=>{
    const FilteredProduct = ServerData.filter(product=>{
      const display = document.getElementById('tbody').innerHTML = '';
      return product.productName.toLowerCase().includes(e.target.value.toLowerCase().trim()) || product.ADCcode.toLowerCase().includes(e.target.value.toLowerCase().trim());
    })

    const product = await FilteredProduct.map(product => {
      return`
        <td  id="incoming" class="border-end" >
                                  <div class=" " scope="col">
                                      <!-- Split dropstart button -->
                                    <div class="btn-group dropstart" style="border-right: 1px dotted rgb(190, 190, 190) !important;" role="group">
                                    <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                                      <span class="visually-hidden">Toggle Dropstart</span>
                                      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAADR0lEQVR4nJ2Vy08TURjF51/Qlf+CS/CFUp6FtrSdvqctbYc+gBYfVJDHQlQkIeIbwfCIC0KCMYrR6MZEKSpEHoIkujAECxsgUCQpAlNYuDjmXqBhBAbKJN9mJvf73Xu+c88wFr6Qs3n8EZvXD85dBK6gEGbeB5PLC4PTA4PDDZ2dB2vjlzUOxxEm0cfmDUQmwmGsr6/vWmtra7RuNzZDwzn8CQPyfYF4o1gstmf1fPwMNefoTRhg9/opQKp5LBZDNLpE5Pqr5rhjCQFsewCqrteh+kad6F39vYdQme1QmWxQGK3I0XOQ6yzIZk3I0pqQoTEgQ61HmkoHmYKdlSlYLWP1FIsAvxcX0dT6BPr8AjrcxpZ2+o586+3rp2BBECQrEongQ+8npCo0MyLAysoKKq/VovBmO4rbhsDd7YW+9A6C1TX029LSEswuL6ZnZiUB8/PzmJqawrlcDRhizS3Al8FhOMvrUNM9Dr5tDLamEZgaeqD1VaJ/YIguvvWgCd2v3x4IcDZHDYb4fgtwvryK+p7Iw9p5aG0uYk2oLQ54LwTp4r6BQQSrrx4OsFcJ2xYvLy/D6PJArjPT4WZqjHS46Xkbw7W6i+KAlJw8MJYEAYIg0Ev39MXLfU9wRp4HhsSCFEDYpcHA8AgCZZWSgMnJSZzOVokBgcsVO7RXbfreXXIp3oA4yuTybMij1lN5ZEoWqUotiCIiAAm1vU4gNcj7j1vQ0fVM+gRZSjBGp+dQgK+jY3CXlEoCTmUpwBi2AYqDV6C1Oqk8eZZ8Ko/SuBELBYGLoiarq6tUDhoLRB6Fll4sM+/dCdgtSfeLA0EQ8Ki1He0dnTvAW4CTmQTgcO8AHKS5IAgY+/4Ddl9A1Hw74ERGLhidnZ//OT5xKMAqkYn3UXnIrSUXy+T0iAEazmlkra653axJtM81SETypvbPX72J7377CZLTc5DQvyNdbTiut/MIhXoQCoVQW9+AQFkFotGoCDA3N7cJkCcGYAhEpR/t7OpCc2sbddGvcBgLCwvxIv8CEhPhcBhJaYcAyFRsqd3np7d95NsYbUZ2+3+9e9+DJFn2dMKAFIXiqEzJ/iGxQHxPhktCjcQC8T2xJtE+OV0+nSSTq/4BNITUZwFW2l8AAAAASUVORK5CYII="
                                      width="20"height="20" >
                                    </button>
                                    <ul class="dropdown-menu p-2" style="overflow-y: scroll;position: fixed;z-index: 1; height:150px;">
                                      <!-- Dropdown menu links -->
                                      <span>History Logs</span>
                                      <div>
                                           ${product.ActivitiyLog.map(log=>{
                                                 return `<p class="border">${log.message}</p>`
                                          })}
                                      </div>
                                    </ul>
                                <!--ends here  -->
                                  <td title="${product.productName}">
                                      ${product.productName}
                                      <a class="text-primary" href="/api/v1/Product/${product.productId}" title="About ${product.productName}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
                                          <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"/>
                                          <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"/>
                                        </svg>
                                      </a>
                                  </td>
                                  <td>
                                      ${product.ADCcode}
                                  </td>
                                  <td>
                                             <!-- product scale -->
                                       <img width="50" height="50" style="filter: drop-shadow(1px 1px 5px rgb(19, 20, 19));" src='
                                       ${product.image ? product.image :  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD9UlEQVR4nO2dT08TQRiHl8QvoNGEbbbtxXD2b2IFCREUbxrxAMabeG27RDi0BvkAJEakKibtzcgFL8aDiRdSh6MpR++WwIHYmXBS4TVTaWxaSmfLru8Cv1/yXtvkefad2c40M5aFIAiCIAiCIAiCIPtFKXVNSrkopSxLKX8rpQiljBloZlLK71LKd0qpvo6fNiI6IaV8BfjK1wdQSpnTbD0LgQwV2EhQLpcLnocpdIYKdGguFArjlmV1mXbHIoSoQIWsrpa+RKPRS6ZCyo0fkHu+REP9Lg0kkqiEOQPNLDe31CRkY2Nj03Hsse7u7jMmQprepiAj2fGDeKN/oklIpVLZ1kJischVkzmk6QPQGckDMdiLqRbiOPadAwsh4aJEewZmQiKjECL+zwNl2CFjECIg5FgOcQPoEJddAoQIfvAQIvhhQ4jgBwwhgh8qhAh+kBASAngEIfzA6KgIqdVgX5Kyj1L0eT6Nmk9TdjxVZeJxcbG9ECnlT9Pl98HeJGTM/30gr/d6Wn7f8dIh35o2qOZab1ChQ9JVBq02qF6+eL/XBtUPL0LettuCxHK863nOaNzCNV5+39raOiel3IEQ19dJvL4mJycyxhtUu10yCyFuIEKKxeUPteHKaAtXh4i6lFLPpJTbGLJcX4ToibxYLH6Mx537/4TETlpeUqlULkOI64uQqanH2ZoIXfF45LwnGXXDFyZ14d8PQT2Rx2L2hY5kQIjr+y9zx3FOdSyDQ8ivZZdeZ1I0ctP/P+WNDKdoIZOufkdol0rCJmQhs/ePLD9LfweEGAoZCaAzGuvucApCjIUMpwIXcu+W/52NISvRuZA3WXSIp0l9IZMOpFMwqR+jGjiqb1l0SAtCBL8ECBH84CFE8MOGEMEPGEIEP1QICQFIghB+eAQh/MAIQvghEYTwgyEI4YdBISgsnQh+CRAi+MFDiOCHDSGCHzCECH6oEBICkAQh/PAIQviBEYTwQyII4QdDEMIPg0JQWDoR/BIgRPCDhxDBDxtCBD9gCBH8UCEkBCAJQvjhEYTwAyMI4YdEEMIPhiCEHwaFoLB0IvglQIjgBw8hgh/2oRKCSjYxCFQILglL+nYJmF9Cyl5OKT3ONdTiFNL19fVNP4Xoi3XbHuyIUi0ZlEpfzU8hNRBypd0ppSi1L4OZmemnWkg0at8+sJBdKTlAVx09eCsrK5/qzllM+CJEXzm9traWhxTlWUZPz9kHNSFGV616ST6ff1gqlYSepPSbAwSpprcpzUafXD09/aQ6TNUdCXvRCiBd+pbj+i9C2W0Z7Mowu667k+jW06cy60lKvzlAit0gITKq2WhGtm2fDkwEgiAIgiAIgliHLn8AKSCcApR8l94AAAAASUVORK5CYII'}
                                         ' alt="photo here" >
                                  </td>
                                  <td style="font-weight: bold;color: ">
                                     <input type="number"  ${product.isActivated ? disabled = "disabled" :"" } data-id="${product._id}"  id="Cartorn" value=${product.currentQty}>
                                  </td>
          
                                  <td ">
                                      <!-- ware house qty -->
                                      <input type="number" 
                                      ${product.isActivated ? disabled = "disabled" :"" }
                                       id="Roll" data-id="${product._id}"  value='${product.Rolls}' >
                                  </td>
                                  <td  class="border-start">
                                       <a href="/api/v1/StoreProduct/${product._id}/edit" >VIEW </a>
                                  </td>
                                 
                            </tr>
      `
    });
  
     document.getElementById('tbody').innerHTML = product
  })

  plsWait(false)
}

          let manager 
          let storeKeeper
         //for managerial role in warehouse
         const managerId = document.getElementById('Manager')
          .addEventListener('change',async function(e){
              const request  = await fetch(`/api/v1/Employee/${e.target.value}`,{
                  method:'GET',
                  headers:{'Content-Type': 'application/json'}
              })
              const response = await request.json()
              manager = response
  
          })
  
          const Store_Keeper = document.getElementById('StoreKeeper')
          .addEventListener('change',async function(e){
              const request  = await fetch(`/api/v1/Employee/${e.target.value}`,{
                  method:'GET',
                  headers:{'Content-Type': 'application/json'}
              })
              const response = await request.json()
              storeKeeper = response
  
          })
  
  
  
  
  
  
  
      //Patch / edit ware house status
        const EditWareHouseForm = document.getElementById('EditWareHouseForm');
        EditWareHouseForm.addEventListener('submit', async function(e){
          e.preventDefault();
          plsWait(true)
          const ADMINID = document.getElementById('ADMINID').value
          const wareHouseId = document.getElementById('WHID').value
          const request = await fetch(`/api/v1/warehouse/${ADMINID}/${wareHouseId}/edit`,{
              body:JSON.stringify({
                  WHName:EditWareHouseForm.WHName.value,
                  Tel:EditWareHouseForm.Tel.value,
                  Email:EditWareHouseForm.Email.value,
                  Address:EditWareHouseForm.Address.value,
                  Manager:manager,
                  Status:EditWareHouseForm.Status.checked,
                  state:EditWareHouseForm.state.value,
                  StoreKeeper:storeKeeper,
                  location:EditWareHouseForm.location.value
              }),
              method:'PATCH',
              headers: {'Content-Type': 'application/json'},
            })
            const response = await request.json().then((res)=>{
              res.result ? ShowServerResponse(res.result) : serverError(res.error)
              location.reload()
            });  
    
      })
  
  
      //Disable check box for each product 
      let incoming = document.querySelectorAll('#toggleReplenish')
  for (let i = 0 ; i < incoming.length ; i++) {
    let confirm = incoming[i].addEventListener('change', async function(e){
      plsWait(true)
        //for batch identifier
        isActivated = e.target.checked
        const url = `/api/v1/warehouse/Product/${incoming[i].dataset.id}`//sends whid
  
          const update = {isActivated}
          const request = await fetch(url,{
          method:'PATCH',
          body: JSON.stringify({update,message:`Product Activation set to:${isActivated} on ${moment().format('l')}`}),
          headers: {'Content-Type': 'application/json'}
          })
          const respose = await request.json().then((response) => {
                  if(response.message){
                    ShowServerResponse(response.message)
                      location.reload()
                  }else if (response.error){
                    serverError(response.error)
                    plsWait(true)
                  }
              })
      })
  
    }
  
    // update productt qty
    let Cartorn = document.querySelectorAll('#Cartorn')
  for (let i = 0 ; i < Cartorn.length ; i++) {
    Cartorn[i].addEventListener('change', async function(e){
      plsWait(true)
        //for batch identifier
        currentQty = e.target.value
        const url = `/api/v1/warehouse/Product/${Cartorn[i].dataset.id}`//sends whid
  
          const update = {currentQty}
          const request = await fetch(url,{
          method:'PATCH',
          body: JSON.stringify({update,message:`Carton Qty was re-Adjusted to ${currentQty} Carton on ${moment().format('l')}`}),
          headers: {'Content-Type': 'application/json'}
          })
          const respose = await request.json().then((response) => {
                  if(response.message){
                    ShowServerResponse(response.message)
                    setTimeout(() =>{
                      plsWait(false)
                    },3000)
                      // qtyApproved = ''
                      // location.reload()
                  }else if (response.error){
                    serverError(response.error)
                    plsWait(false)
                  }
              })
      })
      
  
    }
  
     // update Rolls qty
     let Roll = document.querySelectorAll('#Roll')
  for (let i = 0 ; i < Roll.length ; i++) {
    Roll[i].addEventListener('change', async function(e){
      plsWait(true)
        //for batch identifier
        Rolls = e.target.value
        const url = `/api/v1/warehouse/Product/${Roll[i].dataset.id}`//sends whid
  
          const update = {Rolls}
          const request = await fetch(url,{
          method:'PATCH',
          body: JSON.stringify({update,message:`Roll Qty was re-Adjusted to ${Rolls} Roll, on ${moment().format('l')}`}),
          headers: {'Content-Type': 'application/json'}
          })
          const respose = await request.json().then((response) => {
                  if(response.message){
                    ShowServerResponse(response.message)
                      setTimeout(() =>{
                      plsWait(false)
                    },3000)
                      // location.reload()
                  }else if (response.error){
                    serverError(response.error)
                      plsWait(false)
                  }
              })
      })
  
    }

   getProduct()

  </script>
  
        
    </body>
</html>
