
<!doctype html>
<html lang="en">
    <head>
        <title>BADE || <%= product.Name %></title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <link rel="stylesheet" href="/sale.css" />
        <link rel="icon" type="image/x-icon" href="<%=product.image  ? product.image : 'https://allchannels.com.ng/BADES.jpg'%>">

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
    </head>
  
    <body>
        <header>
            <%-include('./partials/Notification.ejs')%> 
            <%-include('./partials/inactive.ejs')%>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
            <!-- place navbar here -->
            <nav class="dash navbar navbar-light bg-light fixed-top" 
            style="background-color: rgb(173, 168, 105) !important">
                <div class="container-fluid">
                    <span  class="navbar-brand" >
                        <img 
                        onclick="history.back()"
                        width="30"
                        hegith="30"
                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAA
                        ACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
                        <b> <%=product.Name%></b>
                    </span>
                    <!-- <a  >Setup Location</a> -->
                    <button
                        class="navbar-toggler"
                        type="button"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar"
                        aria-controls="offcanvasNavbar"
                    >
                    <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <div
                        class="offcanvas offcanvas-end"
                        tabindex="-1"
                        id="offcanvasNavbar"
                        aria-labelledby="offcanvasNavbarLabel"
                    >
                        <div class="dash offcanvas-header bg-dark-subtle ">
                            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">
                                Menu
                            </h5>
                            <button
                                type="button"
                                class="btn-close text-reset"
                                data-bs-dismiss="offcanvas"
                                aria-label="Close"
                            ></button>
                        </div>
                        <div class="offcanvas-body ">
                            <!-- uls -->
                            <ul class="nav nav-tabs d-flex  align-content-center  " id="myTab" role="tablist" >
                                <%-include('./partials/USER.ejs')%>
                                <li class="nav-item active" role="presentation">
                                    <button
                                        class="nav-link active"
                                        id="profile-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#profile"
                                        type="button"
                                        role="tab"
                                        aria-controls="profile"
                                        aria-selected="false"
                                        title="<%= product.Name %>"
                                    >
                                    <img 
                                        width="30" height="30" style="filter: drop-shadow(1px 1px 5px rgb(19, 20, 19));"
                                        src="<%= product.image ? product.image :'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD9UlEQVR4nO2dT08TQRiHl8QvoNGEbbbtxXD2b2IFCREUbxrxAMabeG27RDi0BvkAJEakKibtzcgFL8aDiRdSh6MpR++WwIHYmXBS4TVTaWxaSmfLru8Cv1/yXtvkefad2c40M5aFIAiCIAiCIAiCIPtFKXVNSrkopSxLKX8rpQiljBloZlLK71LKd0qpvo6fNiI6IaV8BfjK1wdQSpnTbD0LgQwV2EhQLpcLnocpdIYKdGguFArjlmV1mXbHIoSoQIWsrpa+RKPRS6ZCyo0fkHu+REP9Lg0kkqiEOQPNLDe31CRkY2Nj03Hsse7u7jMmQprepiAj2fGDeKN/oklIpVLZ1kJischVkzmk6QPQGckDMdiLqRbiOPadAwsh4aJEewZmQiKjECL+zwNl2CFjECIg5FgOcQPoEJddAoQIfvAQIvhhQ4jgBwwhgh8qhAh+kBASAngEIfzA6KgIqdVgX5Kyj1L0eT6Nmk9TdjxVZeJxcbG9ECnlT9Pl98HeJGTM/30gr/d6Wn7f8dIh35o2qOZab1ChQ9JVBq02qF6+eL/XBtUPL0LettuCxHK863nOaNzCNV5+39raOiel3IEQ19dJvL4mJycyxhtUu10yCyFuIEKKxeUPteHKaAtXh4i6lFLPpJTbGLJcX4ToibxYLH6Mx537/4TETlpeUqlULkOI64uQqanH2ZoIXfF45LwnGXXDFyZ14d8PQT2Rx2L2hY5kQIjr+y9zx3FOdSyDQ8ivZZdeZ1I0ctP/P+WNDKdoIZOufkdol0rCJmQhs/ePLD9LfweEGAoZCaAzGuvucApCjIUMpwIXcu+W/52NISvRuZA3WXSIp0l9IZMOpFMwqR+jGjiqb1l0SAtCBL8ECBH84CFE8MOGEMEPGEIEP1QICQFIghB+eAQh/MAIQvghEYTwgyEI4YdBISgsnQh+CRAi+MFDiOCHDSGCHzCECH6oEBICkAQh/PAIQviBEYTwQyII4QdDEMIPg0JQWDoR/BIgRPCDhxDBDxtCBD9gCBH8UCEkBCAJQvjhEYTwAyMI4YdEEMIPhiCEHwaFoLB0IvglQIjgBw8hgh/2oRKCSjYxCFQILglL+nYJmF9Cyl5OKT3ONdTiFNL19fVNP4Xoi3XbHuyIUi0ZlEpfzU8hNRBypd0ppSi1L4OZmemnWkg0at8+sJBdKTlAVx09eCsrK5/qzllM+CJEXzm9traWhxTlWUZPz9kHNSFGV616ST6ff1gqlYSepPSbAwSpprcpzUafXD09/aQ6TNUdCXvRCiBd+pbj+i9C2W0Z7Mowu667k+jW06cy60lKvzlAit0gITKq2WhGtm2fDkwEgiAIgiAIgliHLn8AKSCcApR8l94AAAAASUVORK5CYII' %>" alt="" srcset="">
                                    </button>
                                </li>
                                <!-- <li class="nav-item" role="presentation">
                                    <button
                                        class="nav-link active"
                                        id="messages-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#messages"
                                        type="button"
                                        role="tab"
                                        aria-controls="messages"
                                        aria-selected="false"
                                        title="<%= product.productName %>"
                                    >
                                    <i class="bi bi-plus-square-fill"><%= product.productName %>
                                    </button>
                                </li> -->
                               </ul> 
                            <div class="list-group mb-5" >
                                <div class="list-group-item list-group-item-action"
                                >
                                <label for="validationCustom01" class="form-label">product Name:</label>
                                <h5><%= product.Name %></h5>
                               </div >
                               <div class="list-group-item list-group-item-action"
                               >
                               <label for="validationCustom01" class="form-label">Product code</label>
                               <p><b><%= product.ACDcode %></b></p>
                              </div >

                              <div class="list-group-item list-group-item-action"
                              >
                              <label for="validationCustom01" class="form-label">Whole-sale Price</label>
                             
                                <p class=""><b>₦<%=product.WareHouse_Price%></b></p>
                            
                             </div >
                             <div class="list-group-item list-group-item-action"
                              >
                              <label for="validationCustom01" class="form-label">Other Price:</label>
                             
                                <p class=""><b>₦<%=product.Van_Price%></b></p>
                            
                             </div >
                             <div class="list-group-item list-group-item-action"
                              >
                              <label for="validationCustom01" class="form-label">Retail Price</label>
                             
                                <p class=""><b>₦<%=product.Market_Price%></b></p>
                            
                             </div >
                            
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
            
           <!-- Nav tabs -->
          
        </header>

        <main class="pt-4 mb-5">
            <!-- Tab panes -->
            <div class="container p-3 bg-light mb-5 mt-5 justify-content-center shadow animate__animated animate__backInLeft">
        
                <input type="file" name="" hidden id="files">
                <form action=""  method="patch" id='form' class="p-2   " >
                    <%if(user.isAdmin ||user.editSalesPrice){%> 
                       
                        <div class="d-flex justify-content-between">
                            <span title="Click to Duplicate <%=product.Name%> " onclick=";location.assign('/api/v1/Clone/Product/<%=product._id%>')">
                                <i class="bi bi-copy"></i>
                            </span>
                            
                            <span id="downloadBTN" onclick="getData()"  title="Download <%=product.Name%> to Pdf">
                                <i class="bi bi-filetype-pdf"></i>
                              </span>
        
                        <%if(!product.Sellable && user.isAdmin){%> 
                            <span title="Delete  <%=product.Name%>"  onclick="RequestDelete(`<%=product._id%>`)">
                                <i class="bi bi-trash3-fill"></i>
                            </span>
                            <%}%>
                       </div>
                       <%}%>

                       <div class="col">
                        <div class="col-md-5">
                            <label for="" class="form-label"><h5><%=product.Name%></h5></label>
                          <input
                            type="text"
                            name="Name"
                            id="Name"
                            class="form-control is-valid"
                            placeholder="Product Name"
                            aria-describedby="helpId"
                            required
                            value="<%=product.Name%>"
                          />
                        </div>
                      </div>
                    
                    <div class="d-flex container-fluid gap-3 p-5 justify-content-around">
                        <!-- cateory -->
                       <div title="scan Me ">
                        
                            <img src="<%=product.QrCode%>" alt="Product QrCode" srcset="">
                       
                       </div>
                        <!-- image -->
                        <div>
                            <label for="files" class="flex flex-col">
                                <div id="productImage" <%if(product.image){%>
                                    style="background-image: url('<%=product.image%>');filter: drop-shadow(5px 2px 5px rgb(19, 20, 19));transition: 0.5s;"
                                <%}%>
                                ></div>
                                <!-- display progress % for photo upload -->
                                <!-- <progress value="0" max="100" id="progress"></progress> -->
                                <input type="url" name="image" value="<%=product.image%>"  id="imageLoader" hidden>
                            </label>
                        </div>
                    </div>
                    <div class="border-bottom rounded d-flex font-bold">
                        <div class="border-end p-1 rounded subs" name="category" title="Double click to show section">Product information</div>
                        <%if(user.isAdmin  ||user.editSalesPrice || user.editPromoPrice ){%>  
                        <div class="border-end rounded p-1 subs" name="category" title="Double click to show section">Product Settings</div>
                        <div class="border-end rounded p-1 subs" name="category" title="Double click to show section">Description</div> 
                        <%}%> 
                    </div>
                    <!-- prouct information -->
                        <div class="d-flex row d-none  border-bottom" id="workInfo">

                            <div class="col-md-4">
                                <label  class="form-label" for="category">Product category</label>
                                 <select id="category" class="form-select" name="Categories">
                                 <optgroup label="category">
                                     <option  class="bg-warning" value="<%=product.category%>"><%=product.category%></option>
                                     <%if(productcat.length > 0){%>
                                        <%productcat.forEach((cat)=>{%>
                                          <option value="<%=cat.NAME.toUpperCase()%>"><%=cat.NAME.toUpperCase()%></option>
                                       <%})%>
                                       <%}%> 
                                 </optgroup>
                                </select>
                             
                            </div>

                                <div class="col-md-4">
                                    <label class="form-label">Whole-sale Price ₦</label>
                                <input type="number"  class="form-control" name="WareHouse_Price" step="any"  <%if(!user.isAdmin || !user.editSalesPrice){%>
                                    disabled
                                <%}%>  value="<%=product.WareHouse_Price%>" placeholder="Eg ₦10.00">
                                </div>
        
                                <div class="col-md-4">
                                    <label class="form-label">Retail Price ₦</label>
                                <input type="number"  class="form-control" name="Market_Price" step="any"  <%if(!user.isAdmin ||!user.editSalesPrice){%>
                                    disabled
                                <%}%>   value="<%=product.Market_Price%>" placeholder="Eg ₦10.00">
                                </div>
        
                                <div class="col-md-4">
                                    <label class="form-label">Others Price ₦ </label>
                                    <input type="number"  class="form-control" disabled name="Van_Price" step="any"  <%if(!user.isAdmin ||!user.editSalesPrice){%>
                                    disabled
                                <%}%>  value="<%=product.Van_Price%>" placeholder="Eg ₦10.00" >
                            </div>
        
                            <div class="col-md-4">
                                <label for="Rolls" class="form-label">Number or Rolls in <%=product.category.toLowerCase()%> Pack</label>
                                <input type="number" class="form-control" name="Rolls" id="Rolls" value="<%=product.Rolls%>" placeholder=' Define number of rolls in Carton ' title=" Define number of rolls in Carton " required>
                            </div>
        
                            <div class="col-md-4">
                                <label for="Pieces" class="form-label">Defined Total <%=product.category.toLowerCase()%> Pieces in a Pack</label>
                                <input type="number" class="form-control" name="Pieces" id="Pieces" value="<%=product.Pieces ? product.Pieces : 0%>" placeholder=' Define number of Pieces in Roll ' title=" Define number of Pieces in roll ">
                            </div>
        
                            <%if(user.isAdmin ||user.isCFO||user.isAccountant){%> 
                            <div class="col-md-4">
                                <label class="fo">Buying price:</label>
                                <input type="number" class="form-control" step="any" name="vendor_Price" disabled value="<%=product.vendor_Price%>" placeholder="Eg ₦10.00" >
                            </div>
        
                            <%if(product.Sellable && user.isAdmin ||user.editPurchasePrice ||user.isAccountant){%> 
                                <div class="col-md-4">
                                    <label class="form-label">Update Buying Price  ₦</label>
                                    <input type="number" class="form-control" step="any" id="updatedBuyingPrice"  value="<%=product.updatedBuyingPrice%>" <%if(!user.editPurchasePrice || !user.isAdmin){%>
                                        disabled
                                    <%}%> placeholder="Eg ₦10.00" title="This field is sensitive. Updating the buying price will re calculate Proffit and Lost">
                                    <%if(user.editPurchasePrice){%>
                                    <button class="btn p-2 shadow-sm btn-danger w-5" title="Update new vendor price for <%=product.Name%>" id="self" onclick="UpdateBuyingPrice()">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-floppy2" viewBox="0 0 16 16">
                                            <path d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0M1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v3.5A1.5 1.5 0 0 1 11.5 6h-7A1.5 1.5 0 0 1 3 4.5V1H1.5a.5.5 0 0 0-.5.5m9.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z"/>
                                        </svg>
                                    </button>
                                    <%}%>
                                </div>
                            <%}%>
        
                            <div class="col-md-4">
                                <label for="pricelist" class="form-label">vendor</label>
                                <select
                                  class="form-select "
                                  name="vendor"
                                  aria-describedby="validationServer04Feedback"
                                  required
                                  id="vendor"
                                >
                                <% vend = vendor.filter(vendor=>{%>
                                    <%return vendor._id.toString() === product.Vendor.toString()  %>
                                    <%})%>
                                    <%vend.map(name=>{%>
                                        <option class="bg-warning" value="<%=product.Vendor%>" ><%=name.Name%></option>
                                        <%})%>
                                
                                <%if(vendor){%>
                                  <%vendor.forEach((vendor)=>{%>
                                      <option value="<%=vendor._id%>"
                                      <%if(vendor.block_vendor){%>
                                        disabled="true"
                                      <%}%>
                                      ><%=vendor.Name%></option>
                                  <%})%>
                                  <%}%>
                                </select>
                                </div>
                                <%}%>
                                
                            <div class="col-md-4">
                            <label class="form-label"> Manufacturer: </label>
                            <input type="text" class="form-control"  value="<%=product.Manufacturer%>"  name="Manufacturer"placeholder='Name of Manufacturer'>
                            </div>
                           <div class="col-md-4">
                            <label class="form-label">
                                Manufacturer Code: 
                            </label>
                            <input type="text" class="form-control" value="<%=product.Manufacture_code%>"  name="ManufacturerCode"placeholder='Name of Manufacturer'>
                            </div>
            
                            <div class="col-md-4">
                                <label class="form-label">
                                Product Code: 
                            </label>
                            <input type="text" class="form-control" required value="<%=product.ACDcode%>"  <%if( !user.isAdmin || !user.editPurchasePrice){%>
                                disabled
                            <%}%>   name="AdcCode"placeholder='Product Code is auto generated but Editable'id="AdcCode" data-id='<%=product._id%>' >
                            </div>
                        </div>
                        <%if(user.isAdmin || user.editSalesPrice){%>   
                        <!-- product settings -->
                        <div id="privateinfo" class="d-flex border-bottom row d-none  ">
                            <div  class="col-md-4">
                                <label  class="form-label">U.O.M :</label>
                                    <select id="measure" class="form-select" name="UMO">
                                    <optgroup label="current">
                                        <option class="bg-warning" value="<%=product.UMO%>"><%=product.UMO%></option>
                                    </optgroup>
                                    <optgroup label="Unit of Measure">
                                        <%if(umo.length > 0){%>
                                            <%umo.forEach((umo)=>{%>
                                            <option value="<%=umo.NAME.toUpperCase()%>"><%=umo.NAME.toUpperCase()%></option>
                                        <%})%>
                                        <%}%>
                                    </optgroup>
                                   </select>
                            </div>
        
                            <div class="col-md-4">
                                <!-- colors -->
                                <label for=""  class="form-label">
                                    Color: 
                                </label>
                                <input type="color" class="form-control" value="<%=product.color%>" name="color">
                            </div>
                            <div class="col-md-4">
                                Sell <%=product.Name%> in Ware House ?
                                <label class="switch">
                                    <input type="checkbox"  id="ActivateProduct" name="Sellable" 
                                    <%if(product.Sellable){%>
                                        checked
                                    <%}%>
                                    >
                                    <div class="slider"></div>
                                </label>
                            </div>
                            <!-- OPTION TO DISPLAY ON VAN SALES  -->
                            <div class="col-md-4">
                                Sell <%=product.Name%> on P.O.S ? 
                                <label class="switch">
                                    <input type="checkbox" name="Ecom_sale" <%if(product.Ecom_sale){%>
                                        checked
                                    <%}%>>
                                    <div class="slider"></div>
                                </label>
                            </div>
                    
                            <div class="col-md-4">
                                <label class="form-label">VAT %</label>
                                <input type="text" class="form-control"  placeholder='set Value Added tax on this product' step="any" name="VAT" value='<%=product.VAT.$numberDecimal ? product.VAT.$numberDecimal : product.VAT%>'  aria-label="Amount (to the nearest dollar)">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Other Promotion ₦</label>
                                <input type="number" class="form-control" disabled placeholder='set Promotion Amount on this product' name="VanPromo" value=<%=product.VanPromo%> aria-label="Amount (to the nearest dollar)" <%if( !user.isAdmin || !user.editPromoPrice){%>
                                    disabled
                                <%}%>>
                            </div>
                            <div  class="col-md-4">
                                <label class="form-label">Retail Promotion ₦</label>
                                <input type="number" class="form-control" placeholder='set Promotion Amount on this product' name="MarketPromo" value=<%=product.MarketPromo%> aria-label="Amount (to the nearest dollar)" <%if( !user.isAdmin || !user.editPromoPrice){%>
                                    disabled
                                <%}%>>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Whole-sale Promotion ₦</label>
                                <input type="number" class="form-control" placeholder='set Promotion Amount on this product' name="WholesalePromo" value=<%=product.WholesalePromo%> aria-label="Amount (to the nearest dollar)" <%if( !user.isAdmin || !user.editPromoPrice){%>
                                    disabled
                                <%}%>>
                            </div>
                            <br>
                        <div class="col-md-12">
                        <!-- product price change -->
                        <label for="form-label"><b>Historical Price Change on <%=product.Name%></b></label>
                        <%try{%>
                            <%if(HistoricalPrice.length > 0){%>
                                <table class="border w-100">
                                  <thead class="border font-bold">
                                   <td  class="border">Date</td>
                                   <td class="border">Old price</td>
                                   <td  class="border">Current Value</td>
                                   <td  class="border">P/L Margin</td>
                                  </thead>
                                  <tbody id="" >
                                  <%HistoricalPrice.forEach((activity)=>{%>
                                  <tr>
                                      <td  class="border"><%=activity.date%></td>
                                      <td class="border">₦<%=activity.oldPrice%></td>
                                      <td  class="border">₦<%=activity.Newprice%></td>
                                      <td  class="border">₦<%=activity.overallPriceChange%></td>
                                  </tr>
                                </tbody>
                                <%})%>        
                               
                             <%}else{%>
                              <tr>
                               <td class="border">No price change registered</td>
                               <td></td>
                               <td></td>
                              </tr>
                              <%}%>
                        <%}catch(e) {%>

                        <%}%>
                       </table>
                        <!-- ends here -->
                        <%}%> 
                        </div>
                    </div>
        
                        <%if(user.isAdmin ||user.editSalesPrice){%>   
                        <!-- description -->
                        <div id="thirdinfo" class="form-floating">
                                <textarea class="form-control" placeholder="Leave a discription here" rows="4" cols="50" name="Description" id="floatingTextarea" title="please note that description added will reflect on your E-commerce Product Description (EPD). Hence, it should be properly Constructed."><%=product.Description%></textarea>
                                <label for="floatingTextarea">Description</label>
                        </div>
                        <%}%> 
        
                    <%if(user.isAdmin ||user.editSalesPrice || user.editPurchasePrice){%> 
                        <div class="col-md-7 mt-2">
                            <button  type="submit" class="btn btn-success">Update <%=product.Name%> </button>
                        </div>
                    <%}%> 
                </form>
              </div>
        
            <!-- ends here -->
        </main>
        <footer>
            <!-- place footer here -->
            <div class="container-fluid fixed-bottom bg-dark-subtle ">
                <div class="row">
                    <div class="col-12">
                        <div class="row">
                            <div class="col-12">
                                <p class="text-center">
                                    BADE &copy; <script>
                                        document.write(new Date().getFullYear());
                                    </script>. All rights reserved.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end of footer -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
        <!-- TODO: Add SDKs for Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>
        <script type="module" src="/ImageUpload.js"></script>
        <script src="https://unpkg.com/jspdf-invoice-template@1.4.0/dist/index.js"></script>
        <script src="/filesaver.js" type="module"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script  src="/Erp.js"></script>
<script>
     const getData = async ()=>{
     const product = document.getElementById('AdcCode')
     productId = product.dataset.id
        const request = await fetch('/api/v1/Getfulldb',{
        method:'GET',
        headers:{'Content-Type': 'application/json'},
    })
        const response = await request.json()
       data =  response.Products.filter(product => {
            return product._id === productId
        
        })


        // download set up
        var pdfObject = await jsPDFInvoiceTemplate.default( {
        outputType: jsPDFInvoiceTemplate.OutputType.Save,
        returnJsPDFDocObject: true,
        fileName: `${data[0].Name}`,
        orientationLandscape: false,
        compress: true,
        logo: {
        src: `${data[0].QrCode}`,
        type: 'JPG', //optional, when src= data:uri (nodejs case)
        width: 26.66, //aspect ratio = width/height
        height: 26.66,
        margin: {
            top: 0, //negative or positive num, from the current position
            left: 0 //negative or positive num, from the current position
        }
        },
        stamp: {
        inAllPages: true, //by default = false, just in the last page
        src: `${data[0].QrCode}`,
        type: 'JPG', //optional, when src= data:uri (nodejs case)
        width: 20, //aspect ratio = width/height
        height: 20,
        margin: {
            top: 0, //negative or positive num, from the current position
            left: 0 //negative or positive num, from the current position
        }
        },
        business: {
        name: `${data[0].ACDcode}`,
        address: ``,
        email:  ``,
        phone: "",
        },
        contact: {
        label: `Category: ${data[0].category}`,
        name: `${data[0].Name}`,
        address: ``,
        phone: ``,
        email: ``,
        otherInfo:``,
        },
        invoice: {
        label:``,
        num: `` ,
        invDate: `Download date : ${moment().format('l')}`,
        invGenDate: ``,
        headerBorder: true,
        tableBodyBorder: true,
        header: [
          {
            title: "#",
            style: {
              width: 10
            }
          },
          {
            title: "Code",
          },
          {
            title: "Market Price",
          },
          {
            title: "Van Price",
          },
          {
            title: "Wholesale Price",
          },
          {
            title: "Qty sold",
          },
          {
            title: "UOM",
          },
          
        ],
        table: data.map((product,index)=>{
          return [index +1,product.ACDcode,product.Market_Price,product.Van_Price,product.WareHouse_Price,product.TotalSale,product.UMO]
        })
         ,
        additionalRows: [{
            col1: 'Total:',
            col2: "145678",
            col3: '',
            style: {
                fontSize: 14 //optional, default 12
            }
        },
        {
            col1: 'VAT:',
            col2: "20",
            col3: '%',
            style: {
                fontSize: 10 //optional, default 12
            }
        },
        {
            col1: 'SubTotal:',
            col2: "116199.90",
            col3: 'ALL',
            style: {
                fontSize: 10 //optional, default 12
            }
        }],
        invDescLabel: ``,
        invDesc: ` `,
        // invTotal: `TOTAL DEBT :NGN${data.map(bill => {return bill.AMOUNT}).reduce((total , currentValue) => {return total + currentValue},0)}`,
        },
        footer: {
        text: "Powered by BADE",
        },
        pageEnable: true,
        pageLabel: "BADE ",
        }); //returns number of pages created
}

    const productcode = document.getElementById('Name').value

    const vendor = document.getElementById('vendor').addEventListener('input', function(e){
    const value = e.target.value
    const ACDcode = `${productcode.substring(0,4)}-${value.charAt(0)}${value.charAt(1)}${value.charAt(2)}`
    document.getElementById('AdcCode').value = ACDcode
    });

    const ProductForm = document.getElementById('form');
    ProductForm.addEventListener('submit',async (e)=>{
        e.preventDefault();
        plsWait(true)
   const Name = ProductForm.Name.value;
   const category = ProductForm.category.value;
   const WareHouse_Price = ProductForm.WareHouse_Price.value;
   const Market_Price = ProductForm.Market_Price.value;
   const Van_Price = ProductForm.Van_Price.value;
   const Vendor = ProductForm.vendor.value;
//    const vendor_Price = ProductForm.vendor_Price.value;
   const Pieces = ProductForm.Pieces.value;
   const UMO = ProductForm.UMO.value;
   const color = ProductForm.elements.color.value;
   const Description = ProductForm.Description.value;
   const ACDcode = ProductForm.AdcCode.value;
   const Sellable =  ProductForm.Sellable.checked;
   const Ecom_sale = ProductForm.Ecom_sale.checked;
   const Manufacturer = ProductForm.Manufacturer.value;
   const Manufacture_code = ProductForm.ManufacturerCode.value;
   const VAT = ProductForm.VAT.value;
   const Rolls = ProductForm.Rolls.value;
   const image = ProductForm.image.value;
   const productId = document.getElementById('AdcCode')
   id = productId.dataset.id
   const WholesalePromo = ProductForm.WholesalePromo.value;
   const VanPromo = ProductForm.VanPromo.value;
   const MarketPromo = ProductForm.MarketPromo.value;
//    const updatedBuyingPrice = ProductForm.updatedBuyingPrice.value;

   const endPoint= `/api/v1/Products/${id}/edit`;
   const update = {Name,
           category,
           WareHouse_Price,
           Market_Price,
           Van_Price,
        //    vendor_Price,
           Vendor,
           UMO,
           color,
           Description,
           Sellable,
           Ecom_sale,
           Manufacturer,
           Manufacture_code,
           ACDcode,
           Rolls,
           VAT,image,WholesalePromo,VanPromo,MarketPromo,Pieces}

   const res = await fetch(endPoint,{
       method:'PATCH',
       body:JSON.stringify(update),
       headers:{'Content-Type': 'application/json'}
   })

   const data = await res.json()
   data?.result ? ShowServerResponse(data.result) : serverError(data.error)
   location.reload()                
    })


    const UpdateBuyingPrice = async ()=>{
        plsWait(true)
       try {
        if(updatedBuyingPrice.value > 0 || updatedBuyingPrice.value !== '' || updatedBuyingPrice.value !== null){
            const product = document.getElementById('AdcCode')
        const updatedBuyingPrice =  document.getElementById('updatedBuyingPrice')
        const self = document.getElementById('self')
        productId = product.dataset.id
       self.setAttribute('disabled', true)
       updatedBuyingPrice.setAttribute('disabled', true)
        // send request to server here
       const request = await fetch(`/api/v1/${productId}/BuyingPrice_change`,{
            method:'PATCH',
            headers:{'Content-Type': 'application/json'},
            body:JSON.stringify({productId,updatedBuyingPrice:updatedBuyingPrice.value})
        })

        await request.json()
        .then((data) =>{
           try {
            if(data.message){
            self.setAttribute('disabled', false)
            updatedBuyingPrice.setAttribute('disabled', false)
            ShowServerResponse(data.message)
            location.reload()
            }
           } catch (error) {
            serverError(error.message)
            plsWait(false)
           }
        })

        }
       } catch (error) {
        serverError(error.message)
        plsWait(false)
       }

    }

</script>
    </body>
</html>
