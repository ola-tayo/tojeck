<!DOCTYPE html>
<html lang="en">
    <%-include('../partials/head.ejs')%>
    <!-- <link rel="stylesheet" href="/feature.css"> -->
    <link rel="stylesheet" href="/main.css"/>
<body >
    
    <nav  class="navbar bg-black">
        <div class="container-fluid">
            <span class="navbar-brand" onclick="history.back()" href="/" title="Back">
                <img 
                width="30"
                hegith="30"
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
               </span>
              <ul class="navbar-nav me-auto mb-2 mb-lg-0" style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
              
                <h5>
                    <a class="breadcrumb-item active" aria-current="page" style="color: #fff !important;"><%=asset.AssetCode.toUpperCase()%>/<%=asset.Name.toUpperCase()%></a>
                </h5>
             
              </ul>
              <%-include('../partials/inactive.ejs')%>
              <%-include('../partials/USER.ejs')%>
        </div>
      </nav>


    <div  class="container bg-light  mt-5 justify-content-center shadow ">
        <!-- main display -->
             <!-- create product form -->
    <div  >
        <div class="d-flex justify-content-between  ">
            
            <b>Current Value : ₦<%=asset.CurrentValue%></b>
            <b>Status : <%=asset.status%></b>
            <!-- image upload div -->
                <input type="file" hidden id="files" name='image' multiple />
        </div>
    <form action=""  method="post" data-id="<%=asset._id%>" id='AssetForm' class="p-2 ">
        <input type="text" placeholder="Asset Name" name="Name" value="<%=asset.Name%>" id="Name" style="width:570px;padding:10px;font-size: x-large;" required/>
        <div class="d-flex  gap-3 p-5 justify-content-around">
            <!-- cateory -->
            <div>
                <label  for="category" class="d-flex justify-content-between gap-7">Asset category </label>
                 <select class="form-select" id="category" name="Categories" required>
                    <option value="<%=asset.Category%>"><%=asset.Category%> [current]</option>
                    <option value="Fixed_Asset">Fixed Asset</option>
                    <option value="Current_Asset">Current Asset</option>
                </select>
            
            </div>



            <!-- image -->
            <div>
                <div class="flex flex-col">
                    <label for="files" ></div>
                        <div id="productImage" <%if(asset.Image){%>
                            style="background-image: url('<%=asset.Image%>');filter: drop-shadow(3px 1px 4px black);transition: 0.5s;"
                        <%}%>
                        ></div>
                    <input type="url" name="image" disabled id="imageLoader" value="<%=asset.Image%>" hidden>
                    </label>
            </div>
            
        </div>
        <div class="border-b flex font-bold">
            <div class="border-end p-1 subs" name="category" title="Double click to show section">Asset information</div>
            <%if(user.role === "Admin" || user.jobTittle === "Accountant" ||user.jobTittle === "CFO"){%> 
            <div class="border-end p-1 subs" name="category" title="Double click to show section">Depreciation Settings</div>
            <div class="border-end p-1 subs" name="category" title="Double click to show section">Depreciation Log</div> 
            <%}%>
        </div>
        <!-- prouct information -->
            <div class="flex flex-col gap-9 d-none border-b p-5 container-fluid" id="workInfo">
               
                
            <%if(user.role === "Admin" || user.jobTittle === "Accountant" ||user.jobTittle === "CFO"){%> 
            <div class="col-md-7">
                <label class="form-label">Asset ID</label>
                    <input
                    class="form-control "
                    name="id"
                    disabled
                    id="id"
                    value="<%=asset.AssetCode%>"
                    />
                </div>

                <div class="col-md-7">
                    <label class="form-label">Asset Vendor</label>
                        <input
                        class="form-control "
                        name="vendor"
                        id="vendor"
                        value="<%=asset.vendor%>"
                        />
                </div>

                <div class="col-md-7">
                    <label for="SerialNumber" class="form-label">Asset Serial Number</label>
                        <input
                        class="form-control "
                        name="SerialNumber"
                        id="SerialNumber"
                        value="<%=asset.SerialNumber%>"
                        placeholder="Example SN/XUEIIOU82377388E"
                        />
                    </div>
            <%}%>

            <div  class="col-md-7">
                <!-- <h1 class="font-bold text-xl">Assign to Employee</h1> -->
                <label for="Employee"  class="flex  gap-7"> Assign to Employee </label>
                   
                    <select id="Employee"  class="form-select " name="Employee" required>
                        
                        <optgroup label="Employee List">
                            <%if(Employees.length > 0){%>
                                <% assign = Employees.filter(Employee=>{%>
                                    <%return Employee._id.toString() === asset.AssignedTo.toString()  %>
                                    <%})%>
                                    <%assign.map(name=>{%>
                                        <option class="bg-warning" value="<%=name._id%>" ><%=name.firstName%> <%=name.lastName%> [current]</option>
                                    <%})%>
                                <%Employees.forEach(employee =>{%>
                                    <option value="<%=employee._id%>"><%=employee.firstName%> <%=employee.lastName%></option>
                                <%})%>
                            <%}%>
                        </optgroup>
                   </select>
            </div>
            <div  class="col-md-7">
                <!-- colors -->
                <label for="Color"  class="flex  gap-7">Color:</label>
                <input type="color" name="color" value="<%=asset.color%>" id="Color">
            </div>
            <div class="col-md-7">
                <label class="flex gap-7" for="PurchsedDate">Date of Purchase</label>
                <input type="date" name="PurchsedDate" value="<%=asset.PurchsedDate%>" id="PurchsedDate">
            </div>

            <div  class="col-md-7">
                <label class="flex gap-7">Description:</label>
                <textarea placeholder='Write a decription' class="textBody"  rows="4" cols="100" name="Description"><%=asset.description%></textarea> 
            </div>

            </div>
            <!-- Depreciation settings -->
            <div id="privateinfo" class="flex flex-col d-none gap-5 p-5 border-b ">
               
                <%if(user.isAdmin ||user.isCFO){%> 
                    <div class="flex gap-7">
                        Asset Activation
                        <label for="Activate" class="switch">
                            <input type="checkbox" id="Activate" value="<%=asset.Activate%>" name="Activate"
                            <%if(asset.Activate === 'on'){%>
                                checked
                            <%}%>
                            >
                            <div class="slider"></div>
                        </label>
                    </div>
                    <!-- OPTION TO DISPLAY ON eCOMMERCE  -->
                    <div class="flex gap-7">
                        Do you want to run depreciation on this Asset ? 
                        <label class="switch">
                            <input type="checkbox" name="runDep" value="<%=asset.runDepreciation%>"
                            <%if(asset.runDepreciation === 'on'){%>
                                checked
                            <%}%>
                            >
                            <div class="slider"></div>
                        </label>
                    </div>

                    <div class="col-md-7">
                        <label class="flex gap-7">Purchase Value ₦</label>
                        <input type="number" step="any" class="form-control" value="<%=asset.PurchasedValue%>" name="BookValue" required placeholder="₦0.00">
                    </div>

                    <div class="col-md-7">
                        <label class="flex gap-7">Resudal /Salvage Value</label>
                            <input type="number" step="any"  class="form-control" value="<%=asset.ResidualValue%>" name="SalvageValue"  placeholder=" ₦0.00">
                        </div>
        
                        <div class="col-md-7">
                            <label class="form-label">Number of Useful Years</label>
                            <input type="number" step="any" name="usefulYear" class="form-control" value="<%=asset.usefulYear%>"  placeholder="Enter value in Years">
                        </div>
                        <div class="col-md-7">
                            <label for="depreciationStartDate">Depreciation Start Date</label>
                            <input type="date" name="depreciationStartDate"  value="<%=asset.depreciationStartDate%>"  id="depreciationStartDate">
                        </div> 
                <%}%>
            </div>
            <!-- description -->
            <div id="thirdinfo" class="flex justify-between p-5 d-none border-b">
                <%if(asset.AcivityLog.length > 0){%>
                    <table class="border w-100">
                      <thead class="border font-bold">
                       <td  class="border">Date</td>
                       <td  class="border">Rate</td>
                       <td  class="border">Current Value</td>
                      </thead>
                      <tbody id="" >
                      <%asset.AcivityLog.forEach((activity)=>{%>
                      <tr>
                          <td  class="border"><%=activity.Date%></td>
                          <td  class="border">₦<%=activity.DepreciatedValue%></td>
                          <td  class="border">₦<%=activity.Assetvalue%></td>
                      </tr>
                    </tbody>
                    <%})%>        
                   
                 <%}else{%>
                  <tr>
                   <td class="border">Nothing to show yet</td>
                   <td></td>
                   <td></td>
                  </tr>
                  <%}%>
               </table>
            </div>
        <%if(user.role === "Admin" || user.jobTittle === "Accountant" ||user.jobTittle === "CFO"){%> 
         <button>Edit <%=asset.Name%> Asset</button>
         <%}%>
    </form>
    </div>
    </div>
</body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
<!-- TODO: Add SDKs for Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>
<script type="module"  src="/ImageUpload.js"></script>
<script  src="/Erp.js"></script>
<script>
//  get the asset form

const AssetForm = document.getElementById('AssetForm')
AssetForm.addEventListener('submit', async (e)=>{
    try {
            const id = AssetForm.dataset.id
            e.preventDefault();

                const request = await fetch(`/api/v1/assets/${id}/edit`,{
                        method:"PATCH",
                        body: JSON.stringify({
                            Name:AssetForm.Name.value,
                            Image:AssetForm.image.value,
                            AssetCode:AssetForm.id.value,
                            Category:AssetForm.Categories.value,
                            PurchasedValue:AssetForm.BookValue.value,
                            vendor:AssetForm.vendor.value,
                            AssignedTo:AssetForm.Employee.value,
                            color:AssetForm.color.value,
                            ResidualValue:AssetForm.SalvageValue.value,
                            usefulYear:AssetForm.usefulYear.value,
                            Activate:AssetForm.Activate.value,
                            runDepreciation:AssetForm.runDep.value,
                            // modelName:AssetForm.modelName.value,
                            PurchsedDate:AssetForm.PurchsedDate.value,
                            depreciationStartDate:AssetForm.depreciationStartDate.value,
                            DepreciationType:'Straight Line',
                            SerialNumber:AssetForm.SerialNumber.value,
                            description:AssetForm.Description.value,
                        }),
                        headers:{'Content-Type': 'application/json'}
                })
                const response = await request.json();
                alert(response.message || response.error)
                response.message ? location.reload() : "" 
        } catch (error) {
            alert(error.message)
        }
})
</script>
<!-- <script src="/Sale.js" type="module"></script> -->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</html>