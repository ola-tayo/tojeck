<%-include('./partials/head.ejs')%>

<nav class="navbar bg-black">
  <div class="container-fluid">
    <span class="navbar-brand" onclick="history.back()" href="/" title="Back">
        <img 
        width="30"
        hegith="30"
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
       </span>
    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      <li class="nav-item dropdown">
        <h5>
          <a
            class="nav-link breadcrumb-item active"
            aria-current="page"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            style="color: #fff !important"
          >
            Replenishment
          </a>
        </h5>
      </li>
    </ul>
    <%-include('./partials/USER.ejs')%>
    <%-include('./partials/inactive.ejs')%>
  </div>
</nav>
<div class="d-flex justify-content-between p-2 m-1 bg-success-subtle ">
  <h5>Product Replenishment</h5>
  <span onclick="location.assign('')" title="Download in Xlsx">
    <img height="40" width="40" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB90lEQVR4nGNgGAWjYBSMgiEJxCYEZ4hNCP4oNjHkP6lY81A96fhg3Uetg3Xp1PQAWY4n2wOHwPgD9TxApuMp9MD/UQ/AwGgMHBpNQsM0CXEXWhRwF1p84Smy+E8RLrH8L9TsMSAe+EKx42G42OI/T4MrBpZck0o2ZiAEqOZ4GB71QOpoDPwXLrP9f+f1o/8gULVpEjx5aLUE/v/x+9f/b79+/NdpDR7cSShiXhnYA2++vP8vUekEFlt5didYrGHr9KGRB3ZdPw52cOO2Gf8te2L///339//tVw/BMTQkPGDSGfn/15/f/99/+/T/2L0L///9+/ffa1r20CqFphxc8R8Glp/ZPvSK0YUnNsE9sOLsDoIeEHfXwsBC04LIxgyUeMBzahY42Zx6cPn/kbvnwZ7wn5k/NDwgXGb7/8aL+2BHg9K9/YQksGcevn32X6zCcfB7oHvPArDjd1w7ChfbdOkAWKx378LB7QGzrihw6QMqNq174+Dihh1h/3///QPGVr2xg9cDPBTgUQ9MG2kxwF1k/plqHigwHwAPFJrnUcUTBeb/hKL0v4m7a75Hx6oZDmRjBmoBCQ+t/+Ri9TR7sjHDqAegYDQG0kaT0EhPQu5aH+nvATvqTXBIemilSXhofaCfB+w+qKbYp1LNA6NgFIyCUcBADQAA6UC2Ipn+q/gAAAAASUVORK5CYII=">
  </span>
</div>
  <div class="container overflow-hidden flex-wrap d-flex">
    
    <%if(products.length > 0){%> <%products.forEach((products)=>{%>

        <!-- display section -->
    <div>
      <div class=" table-responsive " id="incoming" >
          <div class=" table table-dark shadow-sm " >
          <div class=" " scope="col">
              <!-- Split dropstart button -->
    <div class="btn-group">
    <div class="btn-group dropstart" style="border-right: 1px dotted rgb(190, 190, 190) !important;" role="group">
    <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
      <span class="visually-hidden">Toggle Dropstart</span>
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAADR0lEQVR4nJ2Vy08TURjF51/Qlf+CS/CFUp6FtrSdvqctbYc+gBYfVJDHQlQkIeIbwfCIC0KCMYrR6MZEKSpEHoIkujAECxsgUCQpAlNYuDjmXqBhBAbKJN9mJvf73Xu+c88wFr6Qs3n8EZvXD85dBK6gEGbeB5PLC4PTA4PDDZ2dB2vjlzUOxxEm0cfmDUQmwmGsr6/vWmtra7RuNzZDwzn8CQPyfYF4o1gstmf1fPwMNefoTRhg9/opQKp5LBZDNLpE5Pqr5rhjCQFsewCqrteh+kad6F39vYdQme1QmWxQGK3I0XOQ6yzIZk3I0pqQoTEgQ61HmkoHmYKdlSlYLWP1FIsAvxcX0dT6BPr8AjrcxpZ2+o586+3rp2BBECQrEongQ+8npCo0MyLAysoKKq/VovBmO4rbhsDd7YW+9A6C1TX029LSEswuL6ZnZiUB8/PzmJqawrlcDRhizS3Al8FhOMvrUNM9Dr5tDLamEZgaeqD1VaJ/YIguvvWgCd2v3x4IcDZHDYb4fgtwvryK+p7Iw9p5aG0uYk2oLQ54LwTp4r6BQQSrrx4OsFcJ2xYvLy/D6PJArjPT4WZqjHS46Xkbw7W6i+KAlJw8MJYEAYIg0Ev39MXLfU9wRp4HhsSCFEDYpcHA8AgCZZWSgMnJSZzOVokBgcsVO7RXbfreXXIp3oA4yuTybMij1lN5ZEoWqUotiCIiAAm1vU4gNcj7j1vQ0fVM+gRZSjBGp+dQgK+jY3CXlEoCTmUpwBi2AYqDV6C1Oqk8eZZ8Ko/SuBELBYGLoiarq6tUDhoLRB6Fll4sM+/dCdgtSfeLA0EQ8Ki1He0dnTvAW4CTmQTgcO8AHKS5IAgY+/4Ddl9A1Hw74ERGLhidnZ//OT5xKMAqkYn3UXnIrSUXy+T0iAEazmlkra653axJtM81SETypvbPX72J7377CZLTc5DQvyNdbTiut/MIhXoQCoVQW9+AQFkFotGoCDA3N7cJkCcGYAhEpR/t7OpCc2sbddGvcBgLCwvxIv8CEhPhcBhJaYcAyFRsqd3np7d95NsYbUZ2+3+9e9+DJFn2dMKAFIXiqEzJ/iGxQHxPhktCjcQC8T2xJtE+OV0+nSSTq/4BNITUZwFW2l8AAAAASUVORK5CYII="
      width="20"height="20" >
    </button>
    <ul class="dropdown-menu ">
      <!-- Dropdown menu links -->
      <span>History Logs</span>
    </ul>
    </div>
          <div style="overflow:hidden;
          white-space:nowrap;
          text-overflow:ellipsis;
          max-width:150px;" class="col-md-4" scope="row">&nbsp;
              <!-- product name -->
              <%pname = prud.filter(name=>{%>
               <% return name._id.toString() === products.productId.toString()%>
               <%})%>
                <%pname.map(n=>{%>
                  <h6 class="form-label"><%=n.Name.toUpperCase()%></h6>
                  <%if(n.UMO){%>
                    <P><%=n.UMO.toUpperCase()%></P>
                  <%}%>
                <%})%>
          </div>
          <div class="">&nbsp;
            <%pname = prud.filter(name=>{%>
              <% return name._id.toString() === products.productId.toString()%>
              <%})%>
               <%pname.map(n=>{%>
                 <%if(n.image){%>
                  <img src="<%=n.image%>" alt="Photo" srcset="" class="img-fluid img-thumbnail" width="40" height="40">
                 <%}%>
               <%})%>
          </div>
          <div class="divTableCell ">&nbsp;
            <label>Qty in stock</label>
            <h5><%=products.currentQty%></h5>
            <input type="number" id="currentQty" value="<%=products.currentQty%>" disabled hidden/>
          </div> 
          <div class="divTableCell">&nbsp;
            <label for="minQTY">Minimum Qty </label>
            <!-- <h5><%=products.pendings%></h5> -->
            <input type="number" id="minQTY" value="<%=products.replenishMin%>" data-id="<%=products._id%>"/>
        </div>
        <div class="divTableCell">&nbsp;
            <label for="minQTY">Re-Order Qty </label>
            <!-- <h5><%=products.pendings%></h5> -->
            <input type="number" id="re_order" value="<%=products.replenishQty%>" />
        </div>
          <div class="divTableCell">&nbsp; Auto Replenish
              <label class="switch" title="This feature sets reminder when set parameters are reached and will notify the Manager and also send automatic P.O to virtual ware house operator">
                  <input type="checkbox" id="toggleReplenish"Name="AutoReplenish" <%if(products.autoReplenishment){%>
                    checked="checked"
                    <%}%>
                    />
                  <div class="slider"></div>
              </label>
          </div>
        </div>
          </div>
          </div>
          <!-- DivTable.com -->
      <%})%> 
      <%}else{%>
        <p>Nothin to display</p>
      <%}%>
</div>
</div>
<script>
    //get the toogle check boxes
    let incoming = document.querySelectorAll('#incoming')
    for (let i = 0 ; i < incoming.length ; i++) {
        let confirm = incoming[i].querySelector('#toggleReplenish')
        let minQty = incoming[i].querySelector('#minQTY')
        let re_order = incoming[i].querySelector('#re_order')
        if(confirm.checked){
            incoming[i].querySelector('#minQTY').setAttribute('disabled',true);
            incoming[i].querySelector('#re_order').setAttribute('disabled',true);
        }

       
        
        confirm.addEventListener('change', async function(e){
           setqty =  minQty.value;
           setReOrder = re_order.value;
            let productId = minQty.dataset.id
            const url = `/api/v1/warehouse/Product/${productId}`

            const update = {replenishMin :setqty, autoReplenishment : e.target.checked,replenishQty:setReOrder}
            const request = await fetch(url,{
            method:'PATCH',
            body: JSON.stringify({update}),
            headers: {'Content-Type': 'application/json'}
            })
            const respose = await request.json().then((response) => {
                if(response.message){
                    alert(response.message)
                    location.reload()
                }else if (response.error){
                    alert(response.error)
                }
            })
       })
    }
</script>