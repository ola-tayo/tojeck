
<!doctype html>
<html lang="en">
    <head>
        <title><%=name%> || <%=Employee.firstName.toUpperCase()%> <%=Employee.lastName.toUpperCase()%>
        </title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <link rel="icon" type="image/x-icon" href="<%=Employee.image  ? Employee.image : 'https://allchannels.com.ng/BADES.jpg'%>">

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Nova+Square&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/sale.css" />
    </head>
  
    <body>
        <header>
            <%-include('./partials/Notification.ejs')%> 
            <%-include('./partials/inactive.ejs')%>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
            <!-- place navbar here -->
            <nav class="dash navbar navbar-light bg-light fixed-top" 
            style="background-color: rgb(173, 168, 105) !important">
                <div class="container-fluid">
                    <span  class="navbar-brand" >
                        <img 
                        onclick="history.back()"
                        width="30"
                        hegith="30"
                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAA
                        ACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
                       <b> <%=Employee.firstName.toUpperCase()%> <%=Employee.lastName.toUpperCase()%></b>
                    </span>
                    <!-- <a  >Setup Location</a> -->
                    <button
                        class="navbar-toggler"
                        type="button"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar"
                        aria-controls="offcanvasNavbar"
                    >
                    <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <div
                        class="offcanvas offcanvas-end"
                        tabindex="-1"
                        id="offcanvasNavbar"
                        aria-labelledby="offcanvasNavbarLabel"
                    >
                        <div class="dash offcanvas-header bg-dark-subtle ">
                            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">
                                Menu
                            </h5>
                            <button
                                type="button"
                                class="btn-close text-reset"
                                data-bs-dismiss="offcanvas"
                                aria-label="Close"
                            ></button>
                        </div>
                        <div class="offcanvas-body ">
                            <!-- uls -->
                            <ul class="nav nav-tabs d-flex  align-content-center  " id="myTab" role="tablist" >
                               <%-include('./partials/USER.ejs')%>
                                <li class="nav-item " role="presentation">
                                    <a
                                        class="nav-link"
                                        id="profile-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#profile"
                                        type="button"
                                        role="tab"
                                        aria-controls="profile"
                                        aria-selected="false"
                                        href="mailto:<%=Employee.Email %>"
                                        title="Mail <%=Employee.firstName.toUpperCase()%> <%=Employee.lastName.toUpperCase()%>"  
                                    >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-envelope-at-fill" viewBox="0 0 16 16">
                                      <path d="M2 2A2 2 0 0 0 .05 3.555L8 8.414l7.95-4.859A2 2 0 0 0 14 2H2Zm-2 9.8V4.698l5.803 3.546L0 11.801Zm6.761-2.97-6.57 4.026A2 2 0 0 0 2 14h6.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.606-3.446l-.367-.225L8 9.586l-1.239-.757ZM16 9.671V4.697l-5.803 3.546.338.208A4.482 4.482 0 0 1 12.5 8c1.414 0 2.675.652 3.5 1.671Z"/>
                                      <path d="M15.834 12.244c0 1.168-.577 2.025-1.587 2.025-.503 0-1.002-.228-1.12-.648h-.043c-.118.416-.543.643-1.015.643-.77 0-1.259-.542-1.259-1.434v-.529c0-.844.481-1.4 1.26-1.4.585 0 .87.333.953.63h.03v-.568h.905v2.19c0 .272.18.42.411.42.315 0 .639-.415.639-1.39v-.118c0-1.277-.95-2.326-2.484-2.326h-.04c-1.582 0-2.64 1.067-2.64 2.724v.157c0 1.867 1.237 2.654 2.57 2.654h.045c.507 0 .935-.07 1.18-.18v.731c-.219.1-.643.175-1.237.175h-.044C10.438 16 9 14.82 9 12.646v-.214C9 10.36 10.421 9 12.485 9h.035c2.12 0 3.314 1.43 3.314 3.034v.21Zm-4.04.21v.227c0 .586.227.8.581.8.31 0 .564-.17.564-.743v-.367c0-.516-.275-.708-.572-.708-.346 0-.573.245-.573.791Z"/>
                                    </svg>
                                    </a>
                                </li>
                                <li class="nav-item " role="presentation">
                                    <button
                                        class="nav-link active"
                                        id="messages-tab"
                                        data-bs-toggle="tab"
                                        data-bs-target="#messages"
                                        type="button"
                                        role="tab"
                                        aria-controls="messages"
                                        aria-selected="false"
                                        title="Add New Location"
                                    >
                                    Organogram
                                    </button>
                                </li>
                               </ul> 
                            <!-- show hireachy -->
                            <h5 class="form-text">Reporting Hierarchy</h5>
                                 <!-- activities on bills modal -->
                                 <li  class="list-group">
                                  <h5></h5>
                                      <ul class="list-group list-group-flush">
                                          <div class="list-group">
                                         
                                            <!-- Hover added -->
                                            <b class=" top-50 start-50  badge bg-info-subtle shadow text-dark" title=" GMD/CEO/CMD"> GMD/CEO/CMD</b> 
                                              <a class="list-group-item list-group-item-action" >
                                                <img width="30" height="30" src=" https://cdn.pixabay.com/photo/2019/08/11/18/59/icon-4399701_640.png" alt="" srcset="">
                                                GMD/CEO/CMD
                                              </a >
                                              <i class="bi bi-arrow-bar-up"></i>
                                              <% if (Employee.Manager) { %>
                                                <b class=" top-50 start-50  badge bg-success-subtle shadow text-dark">Manager</b> 
                                                <a class="list-group-item list-group-item-action align-content-center" >
                                                  
                                                    <img width="30" height="30" src="<%=Employee.Manager.image ? Employee.Manager.image :" https://cdn.pixabay.com/photo/2019/08/11/18/59/icon-4399701_640.png"%>" alt="" srcset="">
                                                    <%= Employee.Manager.firstName.toUpperCase() %>  <%= Employee.Manager.lastName.toUpperCase() %>
                                                  
                                                </a >
                                                <i class="bi bi-arrow-bar-up"></i>
                                                <% } %>
                                                <b class=" top-50 start-50  badge bg-primary-subtle shadow text-dark" title="<%=Employee.firstName%>">
                                                  <%if(Employee.jobTittle){%>
                     
                                                    <%if(jobTittles.length > 0 && Employee.jobTittle){%>
                                                      <%jobTittle = jobTittles.filter(contract=>{%>
                                                        <%return contract._id.toString() === Employee.jobTittle.toString() %>
                                                      <%})%>
                                                      <%jobTittle.map(jt=>{%>
                                                        <%=jt.Name%> [current]
                                                      <%})%>
                                                      <%}else{%>
                                                        Not Assigned
                                                     <% }%>
                            
                                                <%}%>
                                                </b> 
                                              <a class="list-group-item list-group-item-action d-flex align-content-center" >
                                                
                                                <img width="30" height="30" src="<%=Employee.image ? Employee.image :" https://cdn.pixabay.com/photo/2019/08/11/18/59/icon-4399701_640.png"%>" alt="" srcset="">
                                                <%=Employee.firstName.toUpperCase()%> <%=Employee.lastName.toUpperCase()%>
                                                
                                              </a >
                                            </div>
                                      </ul>
                                    </li>
                        </div>
                    </div>
                </div>
            </nav>
            
           <!-- Nav tabs -->
          
        </header>

        <main class="pt-4 ">
          <div class="container p-3 bg-light mb-5 mt-5 justify-content-center shadow animate__animated animate__backInLeft" >

            <div class="row g-3 " >
              
                <!-- <div class="ribbon "><span><%=Employee.lastSeen%></span></div> -->


                <div class=" d-flex justify-content-end mt-1 gap-2 shadow-sm align-items-center bg-warning-subtle p-2 rounded" >
  
    
                  <div class="p-2	" >
                   
                  </div>
                  <div class="p-2 "  
                    style="background-color:#fff;box-shadow: inset 1px 2px 4px 1px silver; border-radius: 50px;" 
                    ><small class="font-monospace" style="font-size: x-small;">Status: <%=Employee.lastSeen%></small></div>
                    <div class="p-2 " title="Delivered"  
                      style="background-color:#fff;box-shadow: inset 1px 2px 4px 1px silver;  border-radius: 50px;" 
                    ><small class="font-monospace" style="font-size: x-small;">Last Appraisal: <%=Employee.Appraisal%></small></div>
                 </div>
              
              <h3><%=Employee.firstName.toUpperCase()%> <%=Employee.lastName.toUpperCase()%></h3>
                <div  style="width: 12rem;" class="shadow-sm ">
                  <%if(Employee._id.toString() === user._id.toString() ){%>
                  <button
                    class="btn btn-light position-relative"
                    id="BulkUpload"
                  >
                  <i class="bi bi-camera-fill"></i>
                  </button>
                  <% } %>
                  
                    <img src="<%if(Employee.image){%>
                      <%= Employee.image %>
                      <%}else{%>
                         https://cdn.pixabay.com/photo/2019/08/11/18/59/icon-4399701_640.png
                      <%}%>
                      " alt="<%= Employee.firstName %> Photo" class="card-img-top" alt="...">
                </div>
                <!-- view only section -->
                
                <div class="row g-3 p-1 box">
                   <!-- curent sales person -->
                <div class="col-6">
                  <label for="street" class="form-label">Email </label>
                  <p class="form-text"><%= Employee.Email %></p>
                </div>
                <!-- ends here -->
      
                 <!-- curent billing  -->
                 <div class="col-6">
                  <label for="street" class="form-label">Telephone </label>
                  <h5 class="form-text">
                    <%= Employee.telephone %>
                  </h5>
                </div>
                <!-- ends here -->
      
                 <!-- curent priceList  -->
                 <div class="col-6">
                  <label for="street" class="form-label"> Job Tittle </label>
                  <h5 class="form-text">

                    <%if(Employee.jobTittle){%>
                     
                        <%if(jobTittles.length > 0 && Employee.jobTittle){%>
                          <%jobTittle = jobTittles.filter(contract=>{%>
                            <%return contract._id.toString() === Employee.jobTittle.toString() %>
                          <%})%>
                          <%jobTittle.map(jt=>{%>
                            <%=jt.Name%> [current]
                          <%})%>
                          <%}else{%>
                            Not Assigned
                         <% }%>

                    <%}%>
                  </h5>
                </div>
                <!-- ends here -->
      
                <!-- curent email  -->
                <div class="col-6">
                  <label for="street" class="form-label"> Emergency Contact </label>
                  <h5 class="form-text">
                    <%= Employee.EmaergencyContact %>
                  </h5>
                </div>
                <!-- ends here -->
      
                 <!-- curent telephone  -->
                 <div class="col-6">
                  <label for="street" class="form-label"> Emergency Contact Telephone </label>
                  <h5 class="form-text">
                    <%= Employee.EmaergencyContactNumber %>
                  </h5>
                </div>
                <!-- ends here -->
                <!-- curent priceList  -->
                <div class="col-6">
                  <label for="street" class="form-label">Home Address </label>
                  <p class="form-text" style="font-size: x-small;">
                    <%= Employee.HomeAddress %>
                  </p>
                </div>
                <!-- ends here -->
      
                <!-- curent priceList  -->
                <div class="col-6">
                  <label for="street" class="form-label"> Department</label>
                  <h5 class="form-text">
                    <%if(Employee.Department){%>
                      
                      <%if(Departments.length > 0 && Employee.Department){%>
                        <%Department = Departments.filter(contract=>{%>
                          <%return contract._id.toString() === Employee.Department.toString() %>
                        <%})%>
                        <%Department.map(dpt=>{%>
                          <%=dpt.Name%> [current]
                        <%})%>
                          <%}else{%>
                            Not Assigned
                         <% }%>

                    <%}%>
                  </h5>
                </div>
                <!-- ends here -->
      
                <!-- curent priceList  -->
                <div class="col-6">
                  <label for="street" class="form-label"> Gender</label>
                  <h5 class="form-text">
                    <%= Employee.Gender %>
                  </h5>
                </div>
                <!-- ends here -->
                 <!-- curent priceList  -->
                 <div class="col-6">
                  <label for="street" class="form-label"> Birthday<small> M-D-Y</small></label>
                  <h5 class="form-text">
                    <%if(Employee.DOB){%>
                      <%= Employee.DOB.substring(5,10) %>-YYYY
                      <%}else{%>
                        Not assigned
                      <%}%> 
                    
                  </h5>
                </div>
                <!-- ends here -->
      
                <div class="col-6">
                  <label for="street" class="form-label"> Work Location </label>
                  <h5 class="form-text">
                   <%if(WH){%>
                    <%= WH.WHName %>
                    <%}else{%>
                      Not assigned
                    <%}%>  
                  </h5>
                </div>
      
                <!-- <% if (user.AppraisalUser && user._id.toString() === Employee._id.toString() || user.isAdmin) { %>
                  
                  <div class="col-6">
                  
                    <p>
                      <a href="/api/v1/Appraisal/<%=Employee._id%>" class="link-success link-opacity-25-hover">
                      Start Appraisal For <%=Employee.firstName%> <%=Employee.lastName%>
                      </a>
                    </p>
                  </div>
                <% } %> -->
      
      
                <!-- <% if (user.requestLeave && user._id.toString() === Employee._id.toString() || user.isAdmin) { %>
                 
                  <div class="col-6">
                   
                    <p>
                      <a href="/api/v1/TimeOFF/<%=user._id%>?page=1&limit=10&category=all" class="link-warning link-opacity-25-hover">
                      Request Absence || TimeOut
                      </a>
                    </p>
                  </div>
                <% } %> -->
      
                </div>
                <!-- view only div ends here -->
      
              <%if(user.isAdmin || Employee.selfService ){%>
                <form class="row g-3" id="EmployeeForm" >
                  <div class="border-bottom  d-flex m-2 font-bold">
                    <div class="border-end p-1 rounded subs" name="category" title="Double click to show section">Work Information</div>
                    <div class="border-end rounded p-1 subs" name="category" title="Double click to show section"> Personal Infomation</div>
                    <div class="border-end rounded p-1 subs" name="category" title="Double click to show section">User Access</div> 
                </div>
                  
                  <!-- ALL FIELDS FROM FOR HERE -->
                  <div class="d-flex row  border-bottom d-none" id="workInfo">
                    <p class="form-text text-muted">WORK INFOMATION</p>
                    
                      <!-- work info -->
                <div class="col-md-3">
                  <label for="workLocation" class="form-label">Assign Work Location</label>
                  <select  id="workLocation" class="form-select"  name="workLocation">
                    <%if(Employee.workLocation){%>
                      <%locations = Warehouse.filter((Warehouse)=>{%>
                        <%return Warehouse._id.toString() === Employee.workLocation.toString() %>
                      <%})%>
                      <%locations.map(location=>{%>
                        <option  value="<%=location._id%>"><%=location.WHName%> [current]</option>
                      <%})%>
                      <%}else{%>
                       
                      <%}%> 
                    <%Warehouse.forEach(Warehouse=>{%>
                      <option value="<%=Warehouse._id%>" ><%=Warehouse.WHName%></option>
                    <%})%>
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="validationServer02" class="form-label"
                    >[<%= Equiptment.length %>] Equiptment Assigned </label
                  >
                 
                 <select disabled class="form-select" name="Equiptment">
                  <%if(Equiptment.length > 0){%>
                    <%Equiptment.forEach(eq =>{%>
                      <option><%=eq.Name%></option>
                    <%})%>
                  <%}%>
                 </select>
                </div>
                <div class="col-md-3">
                  <label for="Email" class="form-label"
                    >Work Email</label
                  >
                  <div class="input-group has-validation">
                    <span class="input-group-text" id="inputGroupPrepend3">@</span>
                    <input
                      type="text"
                      class="form-control border"
                      id="Email"
                      required
                      aria-describedby="inputGroupPrepend3 validationServerUsernameFeedback"
                      value="<%=Employee.Email%>"
                      name="Email"
                    />
                   
                  </div>
                </div>
                <div class="col-md-3">
                  <label for="validationServer03" class="form-label"
                    >Employee Contract</label
                  >
                  <select
                    class="form-select is-invalid"
                    id="validationServer04"
                    aria-describedby="validationServer04Feedback"
                    name="contract"
                    disabled
                  >
                  <option></option>
                  <%if(Employee.contract){%>
                  <%contra = contract.filter(contract=>{%>
                    <%return contract._id.toString() === Employee.contract.toString() %>
                  <%})%>
                  
                    <option class="bg-warning" value="<%=contra[0]._id%>"><%=contra[0].name%></option>
                    <%}%>

                    <%if(contract.length > 0){%>
                      <%contract.forEach(contract =>{%>
                        <option value="<%=contract._id%>"><%=contract.name%></option>
                     <% })%>
                    <%}%>
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="Manager" class="form-label"
                    >Manager to report to</label
                  >
                  <select
                    class="form-select "
                    id="Manager"
                    name="Manager"
                    aria-describedby="validationServer04Feedback"
                    disabled
                  >
                   <%if(Employee.Manager){%>
                    <option value="<%=Employee.Manager.firstName%> <%=Employee.Manager.lastName%>" ><%=Employee.Manager.firstName%> <%=Employee.Manager.lastName%>[Current]</option>
                    <%}%>
                    <optgroup label="Admin">
                      <%Admin = Employees.filter(staff=>{%>
                        <%return staff.isAdmin%>
                      <%})%>
                        <%Admin.forEach(Employee=>{%>
                          <option value="<%=Employee._id%>" ><%=Employee.firstName%> <%=Employee.lastName%></option>
                        <%})%>
                    </optgroup>
                    <optgroup label="Managers">
                      <%manager = Employees.filter(staff=>{%>
                        <%return staff.isManager%>
                      <%})%>
                        <%manager.forEach(Employee=>{%>
                          <option value="<%=Employee._id%>" ><%=Employee.firstName%> <%=Employee.lastName%></option>
                        <%})%>
                    </optgroup>
                  </select>
                </div>
                <!-- <div class="col-md-3">
                  <label for="Role" class="form-label"
                    > Assign system Role </label
                  >
                  <select
                    class="form-select"
                    id="Role"
                    name="role"
                    aria-describedby="validationServer04Feedback"
                    
                  >
                    <option   value="<%=Employee.role%>"><%=Employee.role%> [current]</option>
                    <option value="N/A">N/A</option>
                      <option value="Admin" >Admin Access</option>
                      <option value="Staff" >Staff Access</option>
                  </select>
                </div> -->
                <div class="col-md-3">
                  <label for="staffId" class="form-label"
                    >Staff ID Number</label
                  >
                  <input
                    type="text"
                    class="form-control border"
                    id="staffId"
                    name="staffId"
                    value="<%=Employee.staffId%>"
                  />
                </div>
      
                <div class="col-md-3">
                  <label for="StartDate" class="form-label"
                    >Employment Date</label
                  >
                  <input
                    type="date"
                    class="form-control border"
                    id="StartDate"
                    name="StartDate"
                    value="<%=Employee.StartDate%>"
                  />
                </div>

                <div class="col-md-3">
                  <label for="MaternityLeave" class="form-label"
                    >Allocate Maternity Leave Days</label
                  >
                  <input
                    type="number"
                    class="form-control border"
                    id="MaternityLeave"
                    name="MaternityLeave"
                    value="<%=Employee.MaternityLeave%>"
                    disabled
                  />
                </div>

                <div class="col-md-3">
                  <label for="STudyLeave" class="form-label"
                    >Allocate Study Leave Days</label
                  >
                  <input
                    type="number"
                    class="form-control border"
                    id="STudyLeave"
                    name="STudyLeave"
                    value="<%=Employee.STudyLeave%>"
                    disabled
                  />
                </div>

                <div class="col-md-3">
                  <label for="SickLeave" class="form-label"
                    >Allocate Sick Leave Days</label
                  >
                  <input
                    type="number"
                    class="form-control border"
                    id="SickLeave"
                    name="SickLeave"
                    value="<%=Employee.SickLeave%>"
                    disabled
                  />
                </div>

                <div class="col-md-3">
                  <label for="AnualLeave" class="form-label"
                    >Allocate Anual Leave Days</label
                  >
                  <input
                    type="number"
                    class="form-control border"
                    id="AnualLeave"
                    name="AnualLeave"
                    value="<%=Employee.AnualLeave%>"
                    disabled
                  />
                </div>
      
                <div class="col-md-3">
                  <label for="EndDate" class="form-label"
                    >Dismisal Date</label
                  >
                  <input
                    type="date"
                    class="form-control border"
                    id="EndDate"
                    name="EndDate"
                    value="<%=Employee.EndDate%>"
                  />
                </div>
                
                <div class="col-md-3">
                  <label for="jobTittle" class="form-label">Job Tittle</label>
                  <select
                    class="form-select "
                    id="jobTittle"
                    required
                    name="jobTittle"
                  >
                 
                  <%if(jobTittles.length > 0 && Employee.jobTittle){%>
                    <%jobTittle = jobTittles.filter(contract=>{%>
                      <%return contract._id.toString() === Employee.jobTittle.toString() %>
                    <%})%>
                    <%jobTittle.map(jt=>{%>
                      <option  value="<%=jt._id%>"><%=jt.Name%> [current]</option>
                    <%})%>
                    <%}else{%>
                      <option value=""></option>
                   <% }%>

                  <%if(jobTittles.length > 0){%>
                    <%jobTittles.forEach(jt =>{%>
                      <option value="<%=jt._id%>"><%=jt.Name%></option>
                   <% })%>
                  <%}%>
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="Department" class="form-label">DEPARTMENT</label>
                  <select
                    class="form-select "
                    id="Department"
                    name="Department"
                  >
                 
                  <%if(Departments.length > 0 && Employee.Department){%>
                    <%Department = Departments.filter(contract=>{%>
                      <%return contract._id.toString() === Employee.Department.toString() %>
                    <%})%>
                    <%Department.map(dpt=>{%>
                      <option  value="<%=dpt._id%>"><%=dpt.Name%> [current]</option>
                    <%})%>
                      <%}else{%>
                        <option value=""></option>
                     <% }%>

                    <%if(Departments.length > 0){%>
                      <%Departments.forEach(DP =>{%>
                        <option value="<%=DP._id%>"><%=DP.Name%></option>
                     <% })%>
                    <%}%>
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="BVN" class="form-label">BVN</label>
                  <input
                    type="text"
                    class="form-control border"
                    id="BVN"
                    aria-describedby="validationServer05Feedback"
                    value="<%=Employee.BVN%>"
                    name="BVN"
                  />
                </div>
                <div class="col-md-4">
                  <label for="NIN" class="form-label">NIN</label>
                  <input
                    type="text"
                    class="form-control border"
                    id="NIN"
                    aria-describedby="validationServer05Feedback"
                    name="NIN"
                    value="<%=Employee.NIN%>"
                  />
                </div>
                
                  <div class="col-md-4">
                    <label for="AccountNumber" class="form-label">Account Number</label>
                    <input
                      type="text"
                      class="form-control border"
                      id="AccountNumber"
                      aria-describedby="validationServer05Feedback"
                      name="AccountNumber"
                      value="<%=Employee.AccountNumber%>"
                    />
                  </div>
                  <div class="col-md-4">
                    <label for="BankName" class="form-label">Bank Name</label>
                    <input
                      type="text"
                      class="form-control border"
                      id="BankName"
                      aria-describedby="validationServer05Feedback"
                      name="BankName"
                      value="<%=Employee.BankName%>"
                    />
                  </div>
                  <div class="col-md-4" >
                    <label for="Target" class="form-label">Sales Target</label><br>
                    <sub>If <%=Employee.firstName%> <%=Employee.lastName%> is a sales Staff, <br>Kindly assign sales target.</sub>
                    <input
                      type="number"
                      class="form-control border"
                      id="Target"
                      aria-describedby="validationServer05Feedback"
                      name="Sales_Target"
                      disabled
                      value="<%=Employee.Sales_Target%>"
                      placeholder="Assign sales tartget for <%=Employee.firstName%> <%=Employee.lastName%>"
                    />
                  </div>
      
                  <div class="col-md-3">
                    <i class="fa fa-calendar-o"></i>
                    <label for="Target_Start" class="form-label">Target Start Date</label><br>
                    <sub>Ensure to assign Start date to begin calculation from</sub>
                    <input
                      type="date"
                      disabled
                      class="form-control border"
                      id="Target_Start"
                      name="Target_Start"
                      value="<%=Employee.Target_Start%>"
                    />
                  </div>
      
                  <div class="col-md-3">
                    <i class="fa fa-calendar-o"></i>
                    <label for="Deadline" class="form-label">Target Achievement Deadline</label><br>
                    <sub>Ensure to assign sales target if period to calculate target Achievement has a value</sub>
                    <input
                      type="date"
                      class="form-control border"
                      disabled
                      id="Deadline"
                      name="Deadline"
                      value="<%=Employee.Deadline%>"
                    />
                  </div>
                  </div>
                  <div id="privateinfo" class="d-flex border-bottom row d-none  ">
                    <p class="form-text text-muted">PERSONAL INFOMATION</p>
                    
                    <div class="col-md-6">
                      <label for="FirstName" class="form-label">First Name</label>
                      <input type="text" class="form-control is-valid border" id="FirstName"  name="firstName" value="<%=Employee.firstName%>" required />
                    </div>
          
                    <div class="col-md-6">
                      <label for="LastName" class="form-label">Last Name</label>
                      <input type="text" class="form-control border is-valid" id="LastName" name="lastName" value="<%=Employee.lastName%>" required />
                    </div>
                    <div class="col-md-6">
                      <label for="inputEmail4" class="form-label">Personal Email</label>
                      <input
                        type="email"
                        class="form-control is-valid border"
                        id="inputEmail4"
                        placeholder="Example@domain.com"
                        name="workEmail"
                        value="<%=Employee.workEmail%>"
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="DOB" class="form-label">Date Of Bitrh</label>
                      <input type="date" class="form-control is-valid border" id="DOB" name="DOB" value="<%=Employee.DOB%>" />
                    </div>
                    <div class="col-12">
                      <label for="inputAddress" class="form-label">Home Address</label>
                      <input
                        type="text"
                        class="form-control border"
                        id="inputAddress"
                        placeholder="1234 Main St"
                        name="HomeAddress"
                        value="<%=Employee.HomeAddress%>"
                      />
                    </div>
                    <div class="col-4">
                      <label for="NOK" class="form-label">Next of Kin</label>
                      <input
                        type="text"
                        class="form-control border"
                        id="NOK"
                        placeholder="Next of Kin"
                        name="NOK"
                        value="<%=Employee.NOK%>"
                      />
                    </div>
                    <div class="col-md-4">
                      <label for="inputState" class="form-label">State of Origin</label>
                      <select id="inputState" class="form-select" name="StateOfOringin">
                        <option  value="<%=Employee.StateOfOringin%>"><%=Employee.StateOfOringin%> [current]</option>
                        
                        <%states.forEach(state=>{%>
                          <option value="<%=state.state%>" ><%=state.state%></option>
                        <%})%>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label for="LGA" class="form-label">LGA</label>
                      <input type="text" class="form-control border" id="LGA" name="LGA" value="<%=Employee.LGA%>"/>
                    </div>
                    <div class="col-md-6">
                      <label for="EmaergencyContact" class="form-label">Emergency Contact Name</label>
                      <input type="text" class="form-control border" id="EmaergencyContact" name="EmaergencyContact"  value="<%=Employee.EmaergencyContact%>"/>
                    </div>
                    <div class="col-md-6">
                      <label for="EmaergencyContactNumber" class="form-label">Emergency contact Number</label>
                      <input type="text" class="form-control border" id="EmaergencyContactNumber"  name="EmaergencyContactNumber" value="<%=Employee.EmaergencyContactNumber%>"/>
                    </div>
                    <div class="col-md-6">
                      <label for="Mobile" class="form-label">Mobile</label>
                      <input
                        type="text"
                        class="form-control border is-invalid"
                        id="Mobile"
                        placeholder="+234-0000-000"
                        required
                        name="telephone"
                        value="<%=Employee.telephone%>"
                      />
                    </div>
                    <div class="row g-3">
                      <h5>Gender</h5>
                      <div class="form-check form-check-inline">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="Gender"
                          id="inlineRadio1"
                          value="Male"
                          <%if(Employee.Gender === "Male"){%>
                            checked="checked"
                            <%}%>
                        />
                        <label class="form-check-label" for="inlineRadio1">Male</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="Gender"
                          id="inlineRadio2"
                          value="Female"
                          <%if(Employee.Gender === "Female"){%>
                            checked="checked"
                            <%}%>
                        />
                        <label class="form-check-label" for="inlineRadio2">Female</label>
                      </div>
                    </div>
    
                    <div class="col-4" >
                      <label style="border: 1px dotted black; padding: 30px;" for="files"
                     >Upload Signature</label
                      >
                      <input type="file" class="form-control" id="files" hidden />
                      <input type="hidden" name="Signature" id="imageLoader" value="<%=Employee.Signature%>" >
                      <div id="productImage" class="d-none"></div>
                    </div>
        
                    <div class="col-4" title="Uploaded Signature for <%=Employee.firstName%>">
                      <img src="<%=Employee.Signature%>" class="form-floating" style="width: 150px; height: 150px;" alt="No signature uploaded" srcset="">
                    </div>
        
                  </div>
                  <div id="thirdinfo" class="flex row justify-between  d-none border-bottom">
                     <!-- USER SETTING AND ACCESS -->
                    <small class="text-muted">USER ACCESS AND SETTINGS</small>
                    
                  <div>
                   
                    <!-- ENDS HERE -->
                    
                      <div class="form-check ">
                        <input class="form-check-input" name="firstTimeOnboard" type="radio" <%if(Employee.firstTimeOnboard){%>
                          checked
                        <%}%>
                          id="invalidCheck2" >
                        <label class="form-check-label" for="invalidCheck2">
                          Send Invitation link
                        </label>
                      </div>
        
                      <div class="form-check form-switch col-4">
                        <input class="form-check-input" type="checkbox" value="<%=Employee.status%>" name="status" id="Employeestatus" <%if(Employee.status === "active"){%>
                            checked="checked"
                            <%}%>>
                        <label class="form-check-label" for="gridCheck1">
                          Grant <%=Employee.firstName%> Acess to Enviroment
                        </label>
                      </div>
      
                    <div class="row justify-content-center align-items-center g-3 mt-2 border-top">
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.createCustomer%>" name="createCustomer" id="createCustomer" <%if(Employee.createCustomer ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="createCustomer">
                            Customer Creation
                          </label>
                        </div>
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.createProduct%>" name="createProduct" id="createProduct" <%if(Employee.createProduct ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="createProduct">
                            Product Creation
                          </label>
                        </div>
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.createVendor%>" name="createVendor" id="createVendor" <%if(Employee.createVendor ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="createVendor">
                            Vendor Creation
                          </label>
                        </div>
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.editSalesPrice%>" name="editSalesPrice" id="editSalesPrice" <%if(Employee.editSalesPrice ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="editSalesPrice">
                            Edit Sales Price
                          </label>
                        </div>
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.raiseLpo%>" name="raiseLpo" id="raiseLpo" <%if(Employee.raiseLpo ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="raiseLpo">
                            Raise P/O
                          </label>
                        </div>
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.raiseInvoice%>" name="raiseInvoice" id="raiseInvoice" <%if(Employee.raiseInvoice ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="raiseInvoice">
                            Raise Invoice
                          </label>
                        </div>
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.isAccountant%>" name="isAccountant" id="isAccountant" <%if(Employee.isAccountant ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="isAccountant">
                           Is Accountant
                          </label>
                        </div>
      
                      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.postPayment%>" name="postPayment" id="postPayment" <%if(Employee.postPayment ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="postPayment">
                            Post Payment
                          </label>
                        </div>
      
                      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.editPromoPrice%>" name="editPromoPrice" id="editPromoPrice" <%if(Employee.editPromoPrice ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="editPromoPrice">
                            Edit Promo 
                          </label>
                        </div>
      
                      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.isAdmin%>" name="isAdmin" id="isAdmin" <%if(Employee.isAdmin ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="isAdmin">
                            Is an Administrator
                          </label>
                        </div>
      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.isManager%>" name="isManager" id="isManager" <%if(Employee.isManager ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="isManager">
                            Is a Manager
                          </label>
                        </div>
      
                      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" disabled value="<%=Employee.payVendor%>" name="payVendor" id="payVendor" <%if(Employee.payVendor ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="payVendor">
                            Register Vendor Payment
                          </label>
                        </div>
      
                      
                        <div class="form-check form-switch col-4">
                          <input class="form-check-input" type="checkbox" value="<%=Employee.editPurchasePrice%>" name="editPurchasePrice" id="editPurchasePrice" <%if(Employee.editPurchasePrice ){%>
                              checked="checked"
                              <%}%>>
                          <label class="form-check-label" for="editPurchasePrice">
                            Edit Purchase Price
                          </label>
                        </div>
      
                      
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" value="<%=Employee.isCFO%>" name="isCFO" id="isCFO" <%if(Employee.isCFO ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="isCFO">Is CFO</label>
                      </div>

                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" disabled value="<%=Employee.isHOD%>" name="isHOD" id="isHOD" <%if(Employee.isHOD ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="isHOD">Is H.O.D</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" disabled value="<%=Employee.creditOfficer%>" name="creditOfficer" id="creditOfficer" <%if(Employee.creditOfficer ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="creditOfficer">Credit Officer</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" value="<%=Employee.cancelInvoice%>" name="cancelInvoice" id="cancelInvoice" <%if(Employee.cancelInvoice ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="cancelInvoice">Can Cancel Invoice</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" value="<%=Employee.DeactivateWareHouse%>" name="DeactivateWareHouse" id="DeactivateWareHouse" <%if(Employee.DeactivateWareHouse ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="DeactivateWareHouse">Deactivate WareHouse</label>
                      </div>
                     
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" disabled value="<%=Employee.accountCreation%>" name="accountCreation" id="accountCreation" <%if(Employee.accountCreation ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="accountCreation">Account Creation</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" value="<%=Employee.reportsUser%>" name="reportsUser" id="reportsUser" <%if(Employee.reportsUser ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="reportsUser">Reports User</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" disabled value="<%=Employee.expenseUser%>" name="expenseUser" id="expenseUser" <%if(Employee.expenseUser ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="expenseUser">Expense User</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" disabled value="<%=Employee.expenseApprover%>" name="expenseApprover" id="expenseApprover" <%if(Employee.expenseApprover ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="expenseApprover">Expense Approver</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox"  disabled value="<%=Employee.expenseManager%>" name="expenseManager" id="expenseManager" <%if(Employee.expenseManager ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="expenseManager">Expense Manager</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox"  value="<%=Employee.notifySalesOrder%>" name="notifySalesOrder" id="notifySalesOrder" <%if(Employee.notifySalesOrder ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="notifySalesOrder">Notify Sales Order</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox"  value="<%=Employee.selfService%>" name="selfService" id="selfService" <%if(Employee.selfService ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="selfService">Access Self Service Portal</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox"  value="<%=Employee.wareHouseManager%>" name="wareHouseManager" id="wareHouseManager" <%if(Employee.wareHouseManager ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="wareHouseManager">WareHouse Manager</label>
                      </div>
      
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox"  value="<%=Employee.allowInternalTransfers%>" name="allowInternalTransfers" id="allowInternalTransfers" <%if(Employee.allowInternalTransfers ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="allowInternalTransfers">Approve Transfers / Purchase</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" disabled value="<%=Employee.requestLeave%>" name="requestLeave" id="requestLeave" <%if(Employee.requestLeave ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="requestLeave">Request Leave</label>
                      </div>
      
                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" disabled value="<%=Employee.AppraisalUser%>" name="AppraisalUser" id="AppraisalUser" <%if(Employee.AppraisalUser ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="AppraisalUser">Appraisal User</label>
                      </div>

                      <div class="form-check form-switch col-4 ">
                        <input class="form-check-input" type="checkbox" value="<%=Employee.createStaff%>" name="createStaff" id="createStaff" <%if(Employee.createStaff ){%>
                          checked="checked"
                          <%}%>>
                        <label class="form-check-label" for="createStaff">create User</label>
                      </div>
      
                    </div>
                  </div>
      
                 
                  <!--  -->
                  </div>
                 
                  <div class="col-12">
                    <input type="hidden" id="id" name="id" value="<%=Employee._id%>">
                    <button class="btn btn-success" type="submit">Update <%=Employee.firstName.toUpperCase()%> <%=Employee.lastName.toUpperCase()%> Record</button>
                  </div>
                </form>  
              <%}%>
        </div>
        </main>
        <footer style="z-index: 3 !important;">
            <!-- place footer here -->
            <div class="container-fluid fixed-bottom bg-dark-subtle ">
              <div class="row">
                  <div class="col-12">
                      <div class="row">
                          <div class="col-12">
                              <p class="text-center">
                                  BADE &copy; <script>
                                      document.write(new Date().getFullYear());
                                  </script>. All rights reserved.
                              </p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
            <!-- end of footer -->
           
        </footer>
       
        <script  src="/Erp.js"></script>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://unpkg.com/jspdf-invoice-template@1.4.0/dist/index.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
<!-- TODO: Add SDKs for Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>
<style>
  .swal-button--confirm {
    background-color: #DD6B55;
  }
</style>
<script type="module">


//DATABASE SHIT STARTS HERE
//FROM BIG BERN 
const firebaseConfig = {
    apiKey: "AIzaSyBED3d1-cLAwWrbQJsH0LJBU1A3iDQbBi0",
    authDomain: "bigbern-erp.firebaseapp.com",
    databaseURL: "https://bigbern-erp-default-rtdb.firebaseio.com",
    projectId: "bigbern-erp",
    storageBucket: "bigbern-erp.appspot.com",
    messagingSenderId: "129741589367",
    appId: "1:129741589367:web:2dfd5bf29e5936bdd1af72",
    measurementId: "G-L3T956JGTM"
};

import { getDatabase, ref, child,onValue, get,}
from "https://www.gstatic.com/firebasejs/9.13.0/firebase-database.js";
import { initializeApp} from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
// initialize firebase
const app = firebase.initializeApp(firebaseConfig);
initializeApp(firebaseConfig);


// form image 
var files = [];
document.getElementById("files").addEventListener("change", function(e) {
    files =  e.target.files;
    for (let i = 0; i < files.length; i++) {
    }
    //checks if files are selected
    if (files.length != 0) {
      //Loops through all the selected files
      for (let i = 0; i < files.length; i++) {
        //create a storage reference
        var storage = firebase.storage().ref(`gkStoreage/${files[i].name}`);
  
        //upload file
        var upload = storage.put(files[i])
  
        //update progress bar
        upload.on(
          "state_changed",ShowServerResponse('Image Selected')
          // function progress(snapshot) {
          //   var percentage =
          //     (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          //   document.getElementById("progress").value = percentage;
          // },
        );
      }
    } else {
      serverError("No file chosen");
    }
  
    upload.then(snapshot => {
         return snapshot.ref.getDownloadURL();   // Will return a promise with the download link
     }).then(downloadURL => {
      // set image url for form
      document.getElementById('imageLoader').value = `${downloadURL}`;
      
      // display image on form
      document.getElementById('productImage').style.backgroundImage = `url(${downloadURL})`;
      
     }).catch(error => {
        // Use to signal error if something goes wrong.
        serverError(`Failed to upload file and get link - ${error}`);
     });
   
  });




  // get manager
  let manager 
  document.getElementById('Manager').addEventListener('change',async (e) =>{
    
    const request = await fetch(`/api/v1/employee/${e.target.value}`,{
      method: 'GET',
      headers:{"content-type": "application/json"}
    })

    const response = await request.json()
    manager = response
  })



  // submit employee form
  const EmployeeForm =  document.getElementById('EmployeeForm')
  EmployeeForm.addEventListener('submit',async(e) => {
    e.preventDefault();
    plsWait(true)
  
    await Swal.fire({
      title: `Update on ${EmployeeForm.firstName.value} ${EmployeeForm.lastName.value} in progress...!`,
      text: "Click ok button to close.",
      icon: "warning",
      showConfirmButton:true,
      showCancelButton:false,
      
    }).then(async(isConfirm) => {
      if (isConfirm) {
            //  submit form here 
            const id = EmployeeForm.id.value
            const request = await fetch(`/api/v1/employee/Onboard/${id}`,{
            method: 'PATCH',
            body: JSON.stringify({
              firstName: EmployeeForm.firstName.value,
              lastName: EmployeeForm.lastName.value,
              Email:EmployeeForm.Email.value,
              DOB:EmployeeForm.DOB.value,
              telephone:EmployeeForm.telephone.value,
              HomeAddress:EmployeeForm.HomeAddress.value,
              NOK:EmployeeForm.NOK.value,
              StateOfOringin:EmployeeForm.StateOfOringin.value,
              LGA:EmployeeForm.LGA.value,
              EmaergencyContact:EmployeeForm.EmaergencyContact.value,
              EmaergencyContactNumber:EmployeeForm.EmaergencyContactNumber.value,
              Gender:EmployeeForm.Gender.value,
              workLocation:EmployeeForm.workLocation.value,
              createStaff:EmployeeForm.createStaff.checked,
              STudyLeave:EmployeeForm.STudyLeave.value,
              AnualLeave:EmployeeForm.AnualLeave.value,
              MaternityLeave:EmployeeForm.MaternityLeave.value,
              SickLeave:EmployeeForm.SickLeave.value,
              workEmail:EmployeeForm.workEmail.value,
              contract:EmployeeForm.contract.value,
              Manager:manager,
              isManager:EmployeeForm.isManager.checked,
              staffId:EmployeeForm.staffId.value,
              jobTittle:EmployeeForm.jobTittle.value,
              Department:EmployeeForm.Department.value,
              BVN:EmployeeForm.BVN.value,
              NIN:EmployeeForm.NIN.value,
              AccountNumber:EmployeeForm.AccountNumber.value,
              BankName:EmployeeForm.BankName.value,
              StartDate:EmployeeForm.StartDate.value,
              EndDate:EmployeeForm.EndDate.value,
              firstTimeOnboard:EmployeeForm.firstTimeOnboard.checked,
              status:EmployeeForm.status.value,
              Signature:EmployeeForm.Signature.value,
              Sales_Target:EmployeeForm.Sales_Target.value,
              Deadline:EmployeeForm.Deadline.value,
              Target_Start:EmployeeForm.Target_Start.value,
              allowInternalTransfers:EmployeeForm.allowInternalTransfers.checked,
              wareHouseManager:EmployeeForm.wareHouseManager.checked,
              notifySalesOrder:EmployeeForm.notifySalesOrder.checked,
              expenseManager:EmployeeForm.expenseManager.checked,
              expenseApprover:EmployeeForm.expenseApprover.checked,
              expenseUser:EmployeeForm.expenseUser.checked,
              reportsUser:EmployeeForm.reportsUser.checked,
              accountCreation:EmployeeForm.accountCreation.checked,
              DeactivateWareHouse:EmployeeForm.DeactivateWareHouse.checked,
              cancelInvoice:EmployeeForm.cancelInvoice.checked,
              creditOfficer:EmployeeForm.creditOfficer.checked,
              isCFO:EmployeeForm.isCFO.checked,
              editPurchasePrice:EmployeeForm.editPurchasePrice.checked,
              payVendor:EmployeeForm.payVendor.checked,
              createVendor:EmployeeForm.createVendor.checked,
              createCustomer:EmployeeForm.createCustomer.checked,
              createProduct:EmployeeForm.createProduct.checked,
              isAdmin:EmployeeForm.isAdmin.checked,
              editPromoPrice:EmployeeForm.editPromoPrice.checked,
              editSalesPrice:EmployeeForm.editSalesPrice.checked,
              postPayment:EmployeeForm.postPayment.checked,
              isAccountant:EmployeeForm.isAccountant.checked,
              raiseInvoice:EmployeeForm.raiseInvoice.checked,
              raiseLpo:EmployeeForm.raiseLpo.checked,
              requestLeave:EmployeeForm.requestLeave.checked,
              AppraisalUser:EmployeeForm.AppraisalUser.checked,
              selfService:EmployeeForm.selfService.checked,
              isHOD:EmployeeForm.isHOD.checked,
            }),
            headers:{"content-type": "application/json"}
          })

          const response = await request.json()

          if(response){
            ShowServerResponse(response.message)
            location.reload()
          }else{
            serverError(response.error)
          }
      } else {
        swal.fire("Cancelled", "Your imaginary file is safe :)", "error");
      }
    })

  });


  const Employeestatus = document.getElementById('Employeestatus')
  Employeestatus.addEventListener('change',async (e) =>{
    if(e.target.value === 'active'){
      e.target.value = 'suspended'
    }else if(e.target.value === 'suspended'){
      e.target.value = 'active'
    }
    ShowServerResponse(`you have set user Access to ${e.target.value}`)
  })


//   -----------
// user image UPLOAD

const imageUpload = document.getElementById("BulkUpload")
imageUpload.addEventListener('click',async ()=>{

  const { value: file } = await Swal.fire({
  title: "Select image",
  input: "file",
  inputAttributes: {
    "accept": "image/*",
    "aria-label": "Upload your profile picture"
  }
});
if (file) {
  const reader = new FileReader();
  reader.onload = async (e) => {

    //checks if files are selected
    if (file) {
     
        //create a storage reference
        var storage = firebase.storage().ref(`gkStoreage/${file}`);
  
        //upload file
        var upload = storage.put(file)
      
    } else {
      serverError("No file chosen");
    }
  
    upload.then(snapshot => {
         return snapshot.ref.getDownloadURL();   // Will return a promise with the download link
     }).then(async downloadURL => {
      // set image url for form
      
      const request = await fetch(`/api/v1/employee/Onboard/${ActiveUser}`,{
      method: "PATCH",
      body: JSON.stringify({image:downloadURL}),
      headers: {
        "Content-Type":"application/json"
      }
      
      })
    const response = await request.json()

    response.message ? ShowServerResponse("New profile photo set") : serverError(response.error)
    response.message ? location.reload() : ""

     }).catch(error => {
        // Use to signal error if something goes wrong.
        serverError(`Failed to upload file and get link - ${error}`);
     });

    Swal.fire({
      title: "Your uploaded picture",
      imageUrl: e.target.result,
      imageAlt: "The uploaded picture"
    });
  };
  reader.readAsDataURL(file);
}
})

</script>

    </body>
</html>